<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="pandoc.css">
</head>
<body>
<h1 id="mycodo-manual">Mycodo Manual</h1>
<h1 id="table-of-contents">Table of Contents</h1>
<p><a href="#about-mycodo">About Mycodo</a></p>
<p><a href="#frequently-asked-questions">Frequently Asked Questions</a></p>
<p><a href="#settings">Settings</a></p>
<ul>
<li><a href="#general-settings">General Settings</a></li>
<li><a href="#relay-usage-settings">Relay Usage Settings</a></li>
<li><a href="#users">Users</a></li>
<li><a href="#user-roles">User Roles</a></li>
<li><a href="#alert-settings">Alert Settings</a></li>
<li><a href="#camera-settings">Camera Settings</a></li>
</ul>
<p><a href="#controllers">Controllers</a></p>
<ul>
<li><a href="#sensors">Sensors</a></li>
<li><a href="#relays">Relays</a></li>
<li><a href="#pids">PIDs</a></li>
<li><a href="#timers">Timers</a></li>
<li><a href="#lcds">LCDs</a></li>
</ul>
<p><a href="#controller-functions">Controller Functions</a></p>
<ul>
<li><a href="#conditional-statements">Conditional Statements</a></li>
<li><a href="#methods">Methods</a></li>
</ul>
<p><a href="#pid-tuning">PID Tuning</a></p>
<ul>
<li><a href="#pid-control-theory">PID Control Theory</a></li>
<li><a href="#quick-setup-examples">Quick Setup Examples</a></li>
<li><a href="#exact-temperature-regulation">Exact-Temperature Regulation</a></li>
<li><a href="#high-temperature-regulation">High-Temperature Regulation</a></li>
</ul>
<p><a href="#miscellaneous">Miscellaneous</a></p>
<ul>
<li><a href="#graphs">Graphs</a></li>
<li><a href="#camera">Camera</a></li>
<li><a href="#relay-usage">Relay Usage</a></li>
<li><a href="#system-backup">System Backup</a></li>
<li><a href="#system-restore">System Restore</a></li>
</ul>
<p><a href="#troubleshooting">Troubleshooting</a></p>
<ul>
<li><a href="#daemon-not-running">Daemon Not Running</a></li>
<li><a href="#more">More</a></li>
</ul>
<p><a href="#appendix">Appendix</a></p>
<p><a href="#temperature-sensors">Temperature Sensors</a></p>
<ul>
<li><a href="#raspberry-pi">Raspberry Pi</a></li>
<li><a href="#atlas-scientific-pt-1000">Atlas Scientific PT-1000</a></li>
<li><a href="#ds18b20">DS18B20</a></li>
<li><a href="#tmp006-tmp007">TMP006, TMP007</a></li>
</ul>
<p><a href="#temperature-humidity-sensors">Temperature, Humidity Sensors</a></p>
<ul>
<li><a href="#am2315">AM2315</a></li>
<li><a href="#dht11">DHT11</a></li>
<li><a href="#dht22-am2302">DHT22, AM2302</a></li>
<li><a href="#htu21d">HTU21D</a></li>
<li><a href="#sht1x">SHT1x</a></li>
<li><a href="#sht7x">SHT7x</a></li>
</ul>
<p><a href="#co2-sensors">CO2 Sensors</a></p>
<ul>
<li><a href="#k-30">K-30</a></li>
</ul>
<p><a href="#moisture-sensors">Moisture Sensors</a></p>
<ul>
<li><a href="#chirp">Chirp</a></li>
</ul>
<p><a href="#pressure-sensors">Pressure Sensors</a></p>
<ul>
<li><a href="#bmp085-bmp180">BMP085, BMP180</a></li>
</ul>
<p><a href="#luminosity-sensors">Luminosity Sensors</a></p>
<ul>
<li><a href="#bh1750">BH1750</a></li>
<li><a href="#tsl2561">TSL2561</a></li>
</ul>
<p><a href="#i2c-multiplexers">I<sup>2</sup>C Multiplexers</a></p>
<ul>
<li><a href="#tca9548a">TCA9548A</a></li>
</ul>
<p><a href="#analog-to-digital-converters">Analog to Digital Converters</a></p>
<ul>
<li><a href="#ads1x15">ADS1x15</a></li>
<li><a href="#mcp342x">MCP342x</a></li>
</ul>
<hr />
<h1 id="about-mycodo">About Mycodo</h1>
<p>Mycodo is a remote monitoring and automated regulation system with a focus on modulating environmental conditions. It was built to run on the Raspberry Pi (versions Zero, 1, 2, and 3) and aims to be easy to install and set up.</p>
<p>The core system coordinates a diverse set of responses to sensor measurements, including actions such as camera captures, email notifications, relay activation/deactivation, regulation with PID control, and more. Mycodo has been used for cultivating gourmet mushrooms, cultivating plants, culturing microorganisms, maintaining honey bee apiary homeostasis, incubating snake eggs and young animals, aging cheeses, fermenting foods, maintaining aquatic systems, and more.</p>
<p>A <a href="https://en.wikipedia.org/wiki/PID_controller">proportional-derivative-integral (PID) controller</a> is a control loop feedback mechanism used throughout industry for controlling systems. It efficiently brings a measurable condition, such as the temperature, to a desired state and maintains it there with little overshoot and oscillation. A well-tuned PID controller will raise to the setpoint quickly, have minimal overshoot, and maintain the setpoint with little oscillation.</p>
<h1 id="frequently-asked-questions">Frequently Asked Questions</h1>
<p><em>Where do I even begin?</em></p>
<p>Here is how I generally set up Mycodo to monitor and regulate:</p>
<ol type="1">
<li>Determine what environmental condition you want to measure or regulate. Consider the devices that must be coupled to achieve this. For instance, temperature regulation require a temperature sensor and an electric heater and/or electric air conditioner.</li>
<li>Determine what relays you will need to power your electric devices. The Raspberry Pi is capable of directly switching relays (using a 3.3-volt signal), although opto-isolating the circuit is advisable. Be careful when selecting a relay not to exceed the current draw of the Raspberry Pi’s PGIO.</li>
<li>See the <a href="#appendix">Appendix</a> for information about what sensors are supported. Acquire one or more of these sensors and relays and connect them to the Raspberry Pi according to the manufacturer’s instructions.</li>
<li>On the <code>Sensors</code> page, create a new sensor, using the dropdown to select the correct sensor. Configure the sensor with the correct communication pins, etc. and save. Activate the sensor to begin recording measurements.</li>
<li>Go to the <code>Data</code> -&gt; <code>Live Measurements</code> page to ensure there is recent data being acquired from the sensor.</li>
<li>On the <code>Relay</code> -&gt; <code>Relays</code> page, add a relay and configure the GPIO pin that switches it, whether the relay switches On when the signal is HIGH or LOW, and what state (On or Off) to set the relay when Mycodo starts.</li>
<li>Test the relay by switching it On and Off from the <code>Relay</code> -&gt; <code>Relays</code> page and make sure the device connected to the relay turns On when you select “On”, and Off when you select “Off”.</li>
<li>On the <code>PID</code> -&gt; <code>PID Controllers</code> page, create a PID controller with the appropriate sensor, measurement, relay, and other parameters. Refer to the <a href="#quick-set-up-examples">Quick Setup Examples</a> for setting up and tuning a PID controller.</li>
<li>On the <code>Data</code> -&gt; <code>Live Graphs</code> page, create a graph that includes the sensor measurement, the relay that is being used by the PID, and the PID setpoint. This provides a good visualization for tuning and adjusting the system.</li>
</ol>
<hr />
<p><em>Why is there only one FAQ?</em></p>
<p>Good question.</p>
<hr />
<h1 id="settings">Settings</h1>
<p>The settings menu, accessed by selecting the gear icon in the top-right, then the Configure link, is a general area for various system-wide configuration options.</p>
<h2 id="general-settings">General Settings</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Language</td>
<td style="text-align: left;">Set the language that will be displayed in the web user interface.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Force HTTPS</td>
<td style="text-align: left;">Require web browsers to use SSL/HTTPS. Any request to http:// will be redirected to https://.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hide success alerts</td>
<td style="text-align: left;">Hide all success alert boxes that appear at the top of the page.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hide info alerts</td>
<td style="text-align: left;">Hide all info alert boxes that appear at the top of the page.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hide warning alerts</td>
<td style="text-align: left;">Hide all warning alert boxes that appear at the top of the page.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Opt-out of statistics</td>
<td style="text-align: left;">Turn off sending anonymous usage statistics. Please consider that this helps the development to leave on.</td>
</tr>
</tbody>
</table>
<h2 id="relay-usage-settings">Relay Usage Settings</h2>
<p>In order to calculate accurate <a href="/usage">relay usage statistics</a>, a few characteristics of your electrical system needs to be know. These variables should describe the characteristics of the electrical system being used by the relays to operate electrical devices. Note: Proper relay usage calculations also rely on the correct current draw to be set for each relay (see <a href="/relay">Relay Options</a>).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Voltage</td>
<td style="text-align: left;">Alternating current (AC) voltage that is switched by the relays. This is usually 120 or 240.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cost per kWh</td>
<td style="text-align: left;">This is how much you pay per kWh.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Currency Unit</td>
<td style="text-align: left;">This is the unit used for the currency that pays for electricity.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Day of Month</td>
<td style="text-align: left;">This is the day of the month (1-30) that the electricity meter is read (which will correspond to the electrical bill).</td>
</tr>
</tbody>
</table>
<h2 id="users">Users</h2>
<p>Mycodo requires at least one Admin user for the login system to be enabled. If there isn’t an Admin user, the web server will redirect to an Admin Creation Form. This is the first page you see when starting Mycodo for the first time. After an Admin user has been created, additional users may be created from the User Settings page.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Username</td>
<td style="text-align: left;">Choose a user name that is between 2 and 64 characters. The user name is case insensitive (all user names are converted to lower-case).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email</td>
<td style="text-align: left;">The email associated with the new account.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Password/Repeat</td>
<td style="text-align: left;">Choose a password that is between 6 and 64 characters and only contain letters, numbers, and symbols.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Role</td>
<td style="text-align: left;">Roles are a way of imposing access restrictions on users, to either allow or deny actions. See the table below for explanations of the four default Roles.</td>
</tr>
</tbody>
</table>
<h2 id="user-roles">User Roles</h2>
<p>Roles define the permissions of each user. There are 4 default roles that determine if a user can view or edit particular areas of Mycodo. Custom roles may be created, but these four roles may not be modified or deleted.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Edit Users</th>
<th style="text-align: left;">Edit Controllers</th>
<th style="text-align: left;">Edit Settings</th>
<th style="text-align: left;">View Settings</th>
<th style="text-align: left;">View Camera</th>
<th style="text-align: left;">View Stats</th>
<th style="text-align: left;">View Logs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Admin</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Editor</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monitor</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
<td style="text-align: left;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Guest</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
<td style="text-align: left;">_</td>
</tr>
</tbody>
</table>
<p><sup>1</sup>The <code>Edit Controllers</code> permission protects the editing of Graphs, LCDs, Methods, PIDs, Relays, Sensors, and Timers.</p>
<p><sup>2</sup>The <code>View Stats</code> permission protects the viewing of usage statistics and the System Info and Relay Usage pages.</p>
<h2 id="alert-settings">Alert Settings</h2>
<p>Alert settings set up the credentials for sending email notifications.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SMTP Host</td>
<td style="text-align: left;">The SMTP server to use to send emails from.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SMTP Port</td>
<td style="text-align: left;">Port to communicate with the SMTP server (465 for SSL, 587 for TSL).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Enable SSL</td>
<td style="text-align: left;">Check to emable SSL, uncheck to enable TSL.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SMTP User</td>
<td style="text-align: left;">The user name to send the email from. This can be just a name or the entire email address.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SMTP Password</td>
<td style="text-align: left;">The password for the user.</td>
</tr>
<tr class="even">
<td style="text-align: left;">From Email</td>
<td style="text-align: left;">What the from email address be set as. This should be the actual email address for this user.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Max emails (per hour)</td>
<td style="text-align: left;">Set the maximum number of emails that can be sent per hour. If more notifications are triggered within the hour and this number has been reached, the notifications will be discarded.</td>
</tr>
</tbody>
</table>
<h2 id="camera-settings">Camera Settings</h2>
<p>Many cameras can be used simultaneously with Mycodo. Each camera needs to be set up in the camera settings, then may be used throughout the software. Note that not every option (such as Hue or White Balance) may be able to be used with your particular camera, due to manufacturer differences in hardware and software.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Select whether the camera is a Raspberry Pi Camera or a USB camera.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Library</td>
<td style="text-align: left;">Select which library to use to communicate with the camera. The Raspberry Pi Camera uses picamera (and potentially opencv), and USB cameras should be set to opencv.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OpenCV Device</td>
<td style="text-align: left;">Any devices detected by opencv will populate this dropdown list. If there are no values in this list, none were detected. If you have multiple opencv devices detected, try setting the camera to each device and take a photo to determine which camera is associated with which device.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Relay ID</td>
<td style="text-align: left;">This relay will turn on during the capture of any still image (which includes timelapses).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rotate Image</td>
<td style="text-align: left;">The number of degrees to rotate the image.</td>
</tr>
<tr class="even">
<td style="text-align: left;">…</td>
<td style="text-align: left;">Image Width, Image Height, Brightness, Contrast, Exposure, Gain, Hue, Saturation, White Balance. These options are self-explanatory. Not all options will work with all cameras.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pre Command</td>
<td style="text-align: left;">A command to execute (as user mycodo) before a still image is captured.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Post Command</td>
<td style="text-align: left;">A command to execute (as user mycodo) after a still image is captured.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Flip horizontally</td>
<td style="text-align: left;">Flip, or mirror, the image horizontally.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Flip vertically</td>
<td style="text-align: left;">Flip, or mirror, the image vertically.</td>
</tr>
</tbody>
</table>
<h1 id="controllers">Controllers</h1>
<p>Controllers are essentially modules that can be used to perform functions or communicate with other parts of Mycodo. Each controller performs a specific task or group of related tasks. There are also Controller Functions, which are larger functions of a controller or controllers and have been given their own sections.</p>
<h2 id="sensors">Sensors</h2>
<p>Sensors measure environmental conditions, which will be stored in an influx database. This database will provide recent measurement for <a href="/help#conditional-statements">Conditional Statements</a> or <a href="/help#pid">PID Controllers</a> to operate from, among other uses.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Activate</td>
<td style="text-align: left;">After the sensor has been properly configured, activation begins acquiring measurements from the sensor. Any activated conditional statements will now being operating.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Deactivate</td>
<td style="text-align: left;">Deactivation stops measurements from being acquired from the sensor. All associated conditional statements will cease to operate.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Save</td>
<td style="text-align: left;">Save the current configuration entered into the input boxes for a particular sensor.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">Delete a particular sensor.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Up/Down</td>
<td style="text-align: left;">Move a particular sensor up or down in the order displayed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Location</td>
<td style="text-align: left;">Depending on what sensor is being used, you will need to either select a serial number (DS18B20 temperature sensor), a GPIO pin (in the case of sensors read by a GPIO), or an I<sup>2</sup>C address. and channel if using the TCA9548A I<sup>2</sup>C multiplexer.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I<sup>2</sup>C Bus</td>
<td style="text-align: left;">The bus to be used to communicate with the I<sup>2</sup>C address. If you’re using an I<sup>2</sup>C multiplexer that provides multiple buses, this allows you to select which bus the sensor is connected to.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Period</td>
<td style="text-align: left;">After the sensor is successfully read and a database entry is made, this is the duration of time waited until the sensor is measured again.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pre Relay</td>
<td style="text-align: left;">If you require a relay to be activated before a measurement is made (for instance, if you have a pump that extracts air to a chamber where the sensor resides), this is the relay number that will be activated. The relay will be activated for a duration defined by the Pre Duration, then once the relay turns off, a measurement by the sensor is made.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pre Relay Duration</td>
<td style="text-align: left;">This is the duration of time that the Pre Relay runs for before the sensor measurement is obtained.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Edge</td>
<td style="text-align: left;">Edge sensors only: Select whether the Rising or Falling (or both) edges of a changing voltage are detected. A number of devices to do this when in-line with a circuit supplying a 3.3-volt input signal to a GPIO, such as simple mechanical switch, a button, a magnet (reed/hall) sensor, a PIR motion detector, and more.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bounce Time (ms)</td>
<td style="text-align: left;">Edge sensors only: This is the number of milliseconds to bounce the input signal. This is commonly called <a href="http://kylegabriel.com/projects/2016/02/morse-code-translator.html#debouncing">debouncing a signal</a>. and may be necessary if using a mechanical circuit.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reset Period</td>
<td style="text-align: left;">Edge sensors only: This is the period of time after an edge detection that another edge will not be recorded. This enables devices such as PIR motion sensors that may stay activated for longer periods of time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplexer (MX)</td>
<td style="text-align: left;">If connected to the TCA9548A I<sup>2</sup>C multiplexer, select what the I<sup>2</sup>C address of the multiplexer is.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mx I<sup>2</sup>C Bus</td>
<td style="text-align: left;">If connected to the TCA9548A I<sup>2</sup>C multiplexer, select the I<sup>2</sup>C bus the multiplexer is connected to.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mx Channel</td>
<td style="text-align: left;">If connected to the TCA9548A I<sup>2</sup>C multiplexer, select the channel of the multiplexer the device is connected to.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Measurement</td>
<td style="text-align: left;">Analog-to-digital converter only: The type of measurement being acquired by the ADC. For instance, if the resistance of a photocell is being measured through a voltage divider, this measurement would be “light”.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Units</td>
<td style="text-align: left;">Analog-to-digital converter only: This is the unit of the measurement. With the above example of “light” as the measurement, the unit may be “lux” or “intensity”.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Channel</td>
<td style="text-align: left;">Analog-to-digital converter only: This is the channel to obtain the voltage measurement from the ADC.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gain</td>
<td style="text-align: left;">Analog-to-digital converter only: set the gain when acquiring the measurement.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Volts Min</td>
<td style="text-align: left;">Analog-to-digital converter only: What is the minimum voltage to use when scaling to produce the unit value for the database. For instance, if your ADC is not expected to measure below 0.2 volts for your particular circuit, set this to “0.2”.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Volts Max</td>
<td style="text-align: left;">Analog-to-digital converter only: This is similar to the Min option above, however it is setting the ceiling to the voltage range. Units Min Analog-to-digital converter only: This value will be the lower value of a range that will use the Min and Max Voltages, above, to produce a unit output. For instance, if your voltage range is 0.0 - 1.0 volts, and the unit range is 1 - 60, and a voltage of 0.5 is measured, in addition to 0.5 being stored in the database, 30 will be stored as well. This enables creating calibrated scales to use with your particular circuit.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Units Max</td>
<td style="text-align: left;">Analog-to-digital converter only: This is similar to the Min option above, however it is setting the ceiling to the unit range.</td>
</tr>
</tbody>
</table>
<h3 id="sensor-verification">Sensor Verification</h3>
<p>Sensor verification was introduced in an earlier version and was broken when the system moved to its new software framework. It was a great feature, and it’s planned to be integrated into the latest version.</p>
<p>This allows the verification of a sensor’s measurement with another sensor’s measurement. This feature is best utilized when you have two sensors in the same location (ideally as close as possible). One sensor (host) should be set up to use the other sensor (slave) to verify. The host sensor should be used to operate the PID, as one feature of the verification is the ability to disable the PID if the difference between measurements is not within the range specified.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GPIO</td>
<td style="text-align: left;">This is the sensor that will be used to verify the sensor measurement. The sensor will be read directly after the first sensor’s measurement to verify whether the sensors have similar measurements.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Difference</td>
<td style="text-align: left;">This is the maximum measured measurement difference between the two sensors before an action is triggered (either notify by email or prevent PID from operating; more below).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Notification</td>
<td style="text-align: left;">If the measurements of the two sensors differ by more than the set <em>Difference</em>, an email will be sent to the address in the <em>Notification</em> field.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stop PID</td>
<td style="text-align: left;">If the measurements of the two sensors differ by more than the set <em>Difference</em>, the PID controller will turn off.</td>
</tr>
</tbody>
</table>
<h2 id="relays">Relays</h2>
<p>Relays are electromechanical or solid-state devices that enable a small voltage signal (such as from a microprocessor) to activate a much larger voltage, without exposing the low -voltage system to the dangers of the higher voltage.</p>
<p>Relays must be properly set up before PID regulation can be achieved. Add and configure relays in the Relay tab. Set the “GPIO Pin” to the BCM GPIO number of each pin that activates each relay. <em>On Trigger</em> should be set to the signal that activates the relay (the device attached to the relay turns on). If your relay activates when the potential across the coil is 0-volts, set <em>On Trigger</em> to “Low”, otherwise if your relay activates when the potential across the coil is 3.3-volts (or whatever switching voltage you are using, if not being driven by the GPIO pin), set it to “High”.</p>
<p>When a relay is initially added, the background of the new relay will be yellow, indicating it is not configured. When properly configured, it will either turn green, indicating the relay is activated (device is on), or red, indicating the relay is inactivated (device is off).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GPIO Pin</td>
<td style="text-align: left;">This is the GPIO that will be the signal to the relay.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Draw (amps)</td>
<td style="text-align: left;">The is the amount of current the device powered by the relay draws. Note: this value should be calculated based on the voltage set in the <a href="#settings-relay-usage">Relay Usage Settings</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">On Trigger</td>
<td style="text-align: left;">This is the state of the GPIO to signal the relay to turn the device on. HIGH will send a 3.3-volt signal and LOW will send a 0-volt signal. If you relay completes the circuit (and the device powers on) when a 3.3-volt signal is sent, then set this to HIGH. If the device powers when a 0-volt signal is sent, set this to LOW.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Start State</td>
<td style="text-align: left;">This specifies whether the relay should be ON or OFF when mycodo initially starts.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Seconds to turn On</td>
<td style="text-align: left;">This is a way to turn a relay on for a specific duration of time. This can be useful for testing the relays and powered devices or the measured effects a device may have on an environmental condition.</td>
</tr>
</tbody>
</table>
<h2 id="pids">PIDs</h2>
<p>A <a href="https://en.wikipedia.org/wiki/PID_controller">proportional-derivative-integral (PID) controller</a> is a control loop feedback mechanism used throughout industry for controlling systems. It efficiently brings a measurable condition, such as the temperature, to a desired state and maintains it there with little overshoot and oscillation. A well-tuned PID controller will raise to the setpoint quickly, have minimal overshoot, and maintain the setpoint with little oscillation.</p>
<p>PID settings may be changed while the PID is activated and the new settings will take effect immediately. If settings are changed while the controller is paused, the values will be used once the controller resumes operation.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Activate/Deactivate</td>
<td style="text-align: left;">Turn a particular PID controller on or off.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pause</td>
<td style="text-align: left;">When paused, the PID will not turn on the associated relays, and settings can be changed without losing current PID output values.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hold</td>
<td style="text-align: left;">When held, the PID will turn on the associated relays, and settings can be changed without losing current PID output values.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Resume</td>
<td style="text-align: left;">Resume a PID controller from being held or paused.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Setpoint</td>
<td style="text-align: left;">This is the specific point you would like the environment to be regaulted at. For example, if you would like the humidity regulated to 60%, enter 60.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Direction</td>
<td style="text-align: left;">This is the direction that you wish to regulate. For example, if you only require the temperature to be raised, set this to “Up,” but if you require regulation up and down, set this to “Both.”</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Period</td>
<td style="text-align: left;">This is the duration between when the PID relay turns off amd when the sensor takes another measurement, the PID is updated, and the relay is turned on again for another duration.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Max Age</td>
<td style="text-align: left;">The time (in seconds) that the sensor measurement age is required to be less than. If the measurement is not younger than this age, the measurement is thrown out and the PID will not actuate the relay. This is a safety measure to ensure the PID is only using recent measurements.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Raise Relay</td>
<td style="text-align: left;">This is the relay that will cause the particular environmental condition to rise. In the case of raising the temperature, this may be a heating pad or coil.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Min Duration (raise)</td>
<td style="text-align: left;">This is the minimum that the PID output must be before the Up Relay turns on. If the PID output exceeds this minimum, the Up Relay will turn on for the PID output number of seconds.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Max Duration (raise)</td>
<td style="text-align: left;">This is the maximum duration the Up Relay is allowed to turn on for. If the PID output exceeds this number, the Up Relay will turn on for no greater than this duration of time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lower Relay</td>
<td style="text-align: left;">This is the relay that will cause the particular environmental condition to lower. In the case of lowering the CO<sub>2</sub>, this may be an exhaust fan.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Min Duration (lower)</td>
<td style="text-align: left;">This is the minimum that the PID output must be before the Down Relay turns on. If the PID output exceeds this minimum, the Down Relay will turn on for the PID output number of seconds.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Max Duration (lower)</td>
<td style="text-align: left;">This is the maximum duration the Down Relay is allowed to turn on for. if the PID output exceeds this number, the Down Relay will turn on for no greater than this duration of time.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">K<sub>P</sub></td>
<td style="text-align: left;">Proportional coefficient (non-negative). Accounts for present values of the error. For example, if the error is large and positive, the control output will also be large and positive.</td>
</tr>
<tr class="even">
<td style="text-align: left;">K<sub>I</sub></td>
<td style="text-align: left;">Integral coefficient (non-negative). Accounts for past values of the error. For example, if the current output is not sufficiently strong, the integral of the error will accumulate over time, and the controller will respond by applying a stronger action.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">K<sub>D</sub></td>
<td style="text-align: left;">Derivative coefficient (non-negative). Accounts for predicted future values of the error, based on its current rate of change.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Integrator Min</td>
<td style="text-align: left;">The minimum allowed integrator value, for calculating Ki_total: (Ki_total = Ki * integrator; and PID output = Kp_total + Ki_total + Kd_total)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Integrator Max</td>
<td style="text-align: left;">The maximum allowed integrator value, for calculating Ki_total: (Ki_total = Ki * integrator; and PID output = Kp_total + Ki_total + Kd_total)</td>
</tr>
</tbody>
</table>
<h2 id="timers">Timers</h2>
<p>Timers enable a relay to be manipulated after specific durations of time or at a specific times of the day. For <em>Duration Timers</em>, both the on duration and the off duration can be defined and the timer will be turned on and off for those durations until deactivated. For <em>Daily Timers</em>, the start hour:minute can be set to turn a specific relay on or off at the specific time of day.</p>
<h2 id="lcds">LCDs</h2>
<p>Data may be output to a liquid crystal display (LCD) for easy viewing. There are only a few number fo LCDs that are supported. Only 16x2 and 20x4 character LCD displays with I<sup>2</sup>C backpacks are supported. Please see the README for specific information regarding compatibility.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Reset Flashing</td>
<td style="text-align: left;">If the LCD is flashing to alert you because it was instructed to do so by a triggered Conditional Statement, use this button to stop the flashing.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Select either a 16x2 or 20x4 character LCD display.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I<sup>2</sup>C Address</td>
<td style="text-align: left;">Select the I<sup>2</sup>C to communicate with the LCD.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplexer I<sup>2</sup>C Address</td>
<td style="text-align: left;">If the LCD is connected to a multiplexer, select the multiplexer I<sup>2</sup>C address.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplexer Channel</td>
<td style="text-align: left;">If the LCD is connected to a multiplexer, select the multiplexer channel the LCD is connected to.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Period</td>
<td style="text-align: left;">This is the period of time (in seconds) between redrawing the LCD with new data.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Display Line #</td>
<td style="text-align: left;">Select which measurement to display on each line of the LCD.</td>
</tr>
</tbody>
</table>
<h1 id="controller-functions">Controller Functions</h1>
<h2 id="conditional-statements">Conditional Statements</h2>
<p>A conditional statement is a way to perform certain actions based on whether a condition is true. Conditional statements can be created for both relays and sensors. Possible conditional statements include:</p>
<ul>
<li>If Relay #1 turns ON, turn Relay #3 ON</li>
<li>If Relay #1 turns ON, turn Relay #4 ON for 40 seconds and notify critical-issue@domain.com</li>
<li>If Relay #4 turns ON for 21 seconds, turn Relay #5 ON for 50 seconds</li>
<li>If Relay #4 turns ON for 20 seconds, turn Relay #1 OFF</li>
<li>If Humidity is Greater Than 80%, turn Relay #4 ON for 40 seconds</li>
<li>If Humidity if Less Than 50%, turn Relay #1 ON for 21 seconds, execute ‘/usr/local/bin/myscript.sh’, and notify email@domain.com</li>
<li>If Temperature if Greater Than 35 C, deactivate PID #1</li>
</ul>
<p>Before activating any conditional statements or PID controllers, it’s advised to thoroughly explore all possible scenarios and plan a configuration that eliminates conflicts. Then, trial run your configuration before connecting devices to the relays. Some devices or relays may respond atypically or fail when switched on and off in rapid succession. Therefore, avoid creating an <a href="https://en.wikipedia.org/wiki/Loop_%28computing%29#Infinite_loops">infinite loop</a> with conditional statements.</p>
<h3 id="conditional-statement-actions">Conditional Statement Actions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Relay</td>
<td style="text-align: left;">Turn a relay on, off, or on for a duration of time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Command</td>
<td style="text-align: left;">Execute a command in the linux shell (as user mycodo).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Activate PID</td>
<td style="text-align: left;">Activate a particular PID controller.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Deactivate PID</td>
<td style="text-align: left;">Deactivate a particular PID controller.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Email</td>
<td style="text-align: left;">Send an email containing information about the current condition that triggered the conditional to send the email.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Flash LCD</td>
<td style="text-align: left;">Have an LCD screen begin flashing in order to alert.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Photo</td>
<td style="text-align: left;">Capture a photo with the selected camera.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email Photo</td>
<td style="text-align: left;">Capture a photo and email it as an attachment to the an email address.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Video</td>
<td style="text-align: left;">Capture a video of a set duration with the selected camera.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email Video</td>
<td style="text-align: left;">Capture a video and email it as an attachment to the an email address.</td>
</tr>
</tbody>
</table>
<h2 id="methods">Methods</h2>
<p>Methods allow different types of setpoint tracking in PID controllers. Normally, a PID controller will regulate an environmental condition to a specific setpoint. If you would like the setpoint to change over time, this is called setpoint tracking. Setpoint tracking is useful for applications such as reflow ovens, thermal cyclers (DNA replication), mimicking natural daily cycles, and more.</p>
<h3 id="universal-options">Universal Options</h3>
<p>These options are shared with several method types.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Start Time/Date</td>
<td style="text-align: left;">This is the start time of a range of time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">End Time/Date</td>
<td style="text-align: left;">This is the end time of a range of time.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Start Setpoint</td>
<td style="text-align: left;">This is the start setpoint of a range of setpoints.</td>
</tr>
<tr class="even">
<td style="text-align: left;">End Setpoint</td>
<td style="text-align: left;">This is the end setpoint of a range of setpoints.</td>
</tr>
</tbody>
</table>
<h3 id="specific-method-options">Specific Method Options</h3>
<h4 id="timedate-method">Time/Date Method</h4>
<p>A time/date method allows a specific time/date span to dictate the setpoint. This is useful for long-running methods, that may take place over the period of days, weeks, or months.</p>
<h4 id="duration-method">Duration Method</h4>
<p>A duration method allows a specific durations of time to dictate the setpoint. This is useful for when short periods of time are required in a method, such as those that take place over the course of a few minutes or hours. Each duration will stack on the previous duration, meaning a newly-added start setpoint will begin from the previous entry’s end setpoint.</p>
<h4 id="daily-time-based-method">Daily (Time-Based) Method</h4>
<p>The daily time-based method is similar to the time/date method, however it will repeat every day. Therefore, it is essential that only the span of one day be set in this method. Begin with the start time at 00:00:00 and end at 23:59:59 (or 00:00:00, which would be 24 hours from the start). The start time must be equal or greater than the previous end time.</p>
<h4 id="daily-sine-wave-method">Daily (Sine Wave) Method</h4>
<p>The daily sine wave method defines the setpoint over the day based on a sinusoidal wave. The sine wave is defined by y = [A * sin(B * x + C)] + D, where A is amplitude, B is frequency, C is the angle shift, and D is the y-axis shift. This method will repeat daily.</p>
<h4 id="daily-bezier-curve-method">Daily (Bezier Curve) Method</h4>
<p>A daily Bezier curve method define the setpoint over the day based on a cubic Bezier curve. If unfamiliar with a Bezier curve, it is recommended you use the <a href="https://www.desmos.com/calculator/cahqdxeshd">graphical Bezier curve generator</a> and use the 8 variables it creates for 4 points (each a set of x and y). The x-axis start (x3) and end (x0) will be automatically stretched or skewed to fit within a 24-hour period and this method will repeat daily.</p>
<h2 id="pid-tuning">PID Tuning</h2>
<h3 id="pid-control-theory">PID Control Theory</h3>
<p>The PID controller is the most common regulatory controller found in industrial settings, for it“s ability to handle both simple and complex regulation. The PID controller has three paths, the proportional, integral, and derivative.</p>
<p>The <strong>P</strong>roportional takes the error and multiplies it by the constant K<sub>p</sub>, to yield an output value. When the error is large, there will be a large proportional output.</p>
<p>The <strong>I</strong>ntegral takes the error and multiplies it by K<sub>i</sub>, then integrates it (K<sub>i</sub> · 1/s). As the error changes over time, the integral will continually sum it and multiply it by the constant K<sub>i</sub>. The integral is used to remove perpetual error in the control system. If using K<sub>p</sub> alone produces an output that produces a perpetual error (i.e. if the sensor measurement never reaches the Set Point), the integral will increase the output until the error decreases and the Set Point is reached.</p>
<p>The <strong>D</strong>erivative multiplies the error by K<sub>d</sub>, then differentiates it (K<sub>d</sub> · s). When the error rate changes over time, the output signal will change. The faster the change in error, the larger the derivative path becomes, decreasing the output rate of change. This has the effect of dampening overshoot and undershoot (oscillation) of the Set Point.</p>
<hr />
<p>Using temperature as an example, the Process Variable (PV) is the measured temperature, the Setpoint (SP) is the desired temperature, and the Error (e) is the distance between the measured temperature and the desired temperature (indicating if the actual temperature is too hot or too cold and to what degree). The error is manipulated by each of the three PID components, producing an output, called the Manipulated Variable (MV) or Control Variable (CV). To allow control of how much each path contributes to the output value, each path is multiplied by a gain (represented by <em>K<sub>P</sub></em>, <em>K<sub>I</sub></em>, and <em>K<sub>D</sub></em>). By adjusting the gains, the sensitivity of the system to each path is affected. When all three paths are summed, the PID output is produced. If a gain is set to 0, that path does not contribute to the output and that path is essentially turned off.</p>
<p>The output can be used a number of ways, however this controller was designed to use the output to affect the measured value (PV). This feedback loop, with a <em>properly tuned</em> PID controller, can achieve a set point in a short period of time, maintain regulation with little oscillation, and respond quickly to disturbance.</p>
<p>Therefor, if one would be regulating temperature, the sensor would be a temperature sensor and the feedback device(s) would be able to heat and cool. If the temperature is lower than the Set Point, the output value would be positive and a heater would activate. The temperature would rise toward the desired temperature, causing the error to decrease and a lower output to be produced. This feedback loop would continue until the error reaches 0 (at which point the output would be 0). If the temperature continues to rise past the Set Point (this is may be acceptable, depending on the degree), the PID would produce a negative output, which could be used by the cooling device to bring the temperature back down, to reduce the error. If the temperature would normally lower without the aid of a cooling device, then the system can be simplified by omitting a cooler and allowing it to lower on its own.</p>
<p>Implementing a controller that effectively utilizes <em>K<sub>P</sub></em>, <em>K<sub>I</sub></em>, and <em>K<sub>D</sub></em> can be challenging. Furthermore, it is often unnecessary. For instance, the <em>K<sub>I</sub></em> and <em>K<sub>D</sub></em> can be set to 0, effectively turning them off and producing the very popular and simple P controller. Also popular is the PI controller. It is recommended to start with only <em>K<sub>P</sub></em> activated, then experiment with <em>K<sub>P</sub></em> and <em>K<sub>I</sub></em>, before finally using all three. Because systems will vary (e.g. airspace volume, degree of insulation, and the degree of impact from the connected device, etc.), each path will need to be adjusted through experimentation to produce an effective output.</p>
<h3 id="quick-setup-examples">Quick Setup Examples</h3>
<p>These example setups are meant to illustrate how to configure regulation in particular directions, and not to achieve ideal values to configure your <em>K<sub>P</sub></em>, <em>K<sub>I</sub></em>, and <em>K<sub>D</sub></em> gains. There are a number of online resources that discuss techniques and methods that have been developed to determine ideal PID values (such as <a href="http://robotics.stackexchange.com/questions/167/what-are-good-strategies-for-tuning-pid-loops">here</a>, <a href="http://innovativecontrols.com/blog/basics-tuning-pid-loops">here</a>, <a href="https://hennulat.wordpress.com/2011/01/12/pid-loop-tuning-101/">here</a>, <a href="http://eas.uccs.edu/wang/ECE4330F12/PID-without-a-PhD.pdf">here</a>, and <a href="http://www.atmel.com/Images/doc2558.pdf">here</a>) and since there are no universal values that will work for every system, it is recommended to conduct your own research to understand the variables and essential to conduct your own experiments to effectively implement them.</p>
<p>Provided merely as an example of the variance of PID values, one of my setups had temperature PID values (up regulation) of <em>K<sub>P</sub></em> = 30, <em>K<sub>I</sub></em> = 1.0, and <em>K<sub>D</sub></em> = 0.5, and humidity PID values (up regulation) of <em>K<sub>P</sub></em> = 1.0, <em>K<sub>I</sub></em> = 0.2, and <em>K<sub>D</sub></em> = 0.5. Furthermore, these values may not have been optimal but they worked well for the conditions of my environmental chamber.</p>
<h3 id="exact-temperature-regulation">Exact Temperature Regulation</h3>
<p>This will set up the system to raise and lower the temperature to a certain level with two regulatory devices (one that heats and one that cools).</p>
<p>Add a sensor, then save the proper device and pin/address for each sensor and activate the sensor.</p>
<p>Add two relays, then save each GPIO and On Trigger state.</p>
<p>Add a PID, then select the newly-created sensor. Change <em>Setpoint</em> to the desired temperature, <em>Regulate Direction</em> to “Both”. Set <em>Raise Relay</em> to the relay attached to the heating device and the <em>Lower Relay</em> to the relay attached to the cooling device.</p>
<p>Set <em>K<sub>P</sub></em> = 1, <em>K<sub>I</sub></em> = 0, and <em>K<sub>D</sub></em> = 0, then activate the PID.</p>
<p>If the temperature is lower than the Set Point, the heater should activate at some interval determined by the PID controller until the temperature rises to the set point. If the temperature goes higher than the Set Point (or Set Point + Buffer), the cooling device will activate until the temperature returns to the set point. If the temperature is not reaching the Set Point after a reasonable amount of time, increase the <em>K<sub>P</sub></em> value and see how that affects the system. Experiment with different configurations involving only <em>Read Interval</em> and <em>K<sub>P</sub></em> to achieve a good regulation. Avoid changing the <em>K<sub>I</sub></em> and <em>K<sub>D</sub></em> from 0 until a working regulation is achieved with <em>K<sub>P</sub></em> alone.</p>
<p>View graphs in the 6 to 12 hour time span to identify how well the temperature is regulated to the Setpoint. What is meant by well-regulated will vary, depending on your specific application and tolerances. Most applications of a PID controller would like to see the proper temperature attained within a reasonable amount of time and with little oscillation around the Setpoint.</p>
<p>Once regulation is achieved, experiment by reducing <em>K<sub>P</sub></em> slightly (~25%) and increasing <em>K<sub>I</sub></em> by a low amount to start, such as 0.1 (or lower, 0.01), then start the PID and observe how well the controller regulates. Slowly increase <em>K<sub>I</sub></em> until regulation becomes both quick and with little oscillation. At this point, you should be fairly familiar with experimenting with the system and the <em>K<sub>D</sub></em> value can be experimented with once both <em>K<sub>P</sub></em> and <em>K<sub>I</sub></em> have been tuned.</p>
<h3 id="high-temperature-regulation">High Temperature Regulation</h3>
<p>Often the system can be simplified if two-way regulation is not needed. For instance, if cooling is unnecessary, this can be removed from the system and only up-regulation can be used.</p>
<p>Use the same configuration as the <a href="#exact-temperature-regulation">Exact Temperature Regulation</a> example, except change <em>Regulate Direction</em> to “Raise” and do not touch the “Down Relay” section.</p>
<h1 id="miscellaneous">Miscellaneous</h1>
<h2 id="graphs">Graphs</h2>
<p>There are two different types of graphs, Live and Asynchronous.</p>
<h3 id="live-graphs">Live Graphs</h3>
<p>A graphical data display that is useful for viewing data sets spanning relatively short periods of time (hours/days/weeks). Select a time frame to view data and continually updating data from new sensor measurements. Multiple graphs can be created on one page that enables a dashboard to be created of graphed sensor data. Each graphs may have one or more sensor measurement, relay duration, or PID setpoint rendered onto it. Several live graph options exist, such as the time period (x-axis) and line colors, as well as navigation and data/image export options. To edit graph options, select the plus sign on the top-right of a graph.</p>
<h3 id="asynchronous-graphs">Asynchronous Graphs</h3>
<p>A graphical data display that is useful for viewing data sets spanning relatively long periods of time (weeks/months/years), which could be very data- and processor-intensive to view as a Live Graph. Select a time frame and data will be loaded from that time span, if it exists. The first view will be of the entire selected data set. For every view/zoom, 700 data points will be loaded. If there are more than 700 data points recorded for the time span selected, 700 points will be created from an averaging of the points in that time span. This enables much less data to be used to navigate a large data set. For instance, 4 months of data may be 10 megabytes if all of it were downloaded. However, when viewing a 4 month span, it’s not possible to see every data point of that 10 megabytes, and aggregating of points is inevitable. With asynchronous loading of data, you only download what you see. So, instead of downloading 10 megabytes every graph load, only ~50kb will be downloaded until a new zoom level is selected, at which time only another ~50kb is downloaded.</p>
<p>Note: Live Graphs require measurements to be acquired, therefore at least one sensor needs to be added and activated in order to display live data.</p>
<h2 id="camera">Camera</h2>
<p>Once a cameras has been set up (in the <a href="#camera-settings">Camera Settings</a>), it may be used to capture still images, create time-lapses, and stream video. Cameras may also be used with <a href="#conditional-statements">Conditional Statements</a> to trigger a camera image or video capture (as well as the ability to email the image/video with a notification).</p>
<h2 id="relay-usage">Relay Usage</h2>
<p>Relay usage statistics are calculated for each relay, based on how long the relay has been powered, the current draw of the device connected to the relay, and other <a href="#relay-usage-settings">relay usage options</a>.</p>
<h2 id="system-backup">System Backup</h2>
<p>A backup is made to /var/Mycodo-backups when the system is upgraded through the web interface or the upgrade script.</p>
<h2 id="system-restore">System Restore</h2>
<p>If you need to restore a backup, do the following, changing the appropriate directory names with these commands, changing ‘user’ to your user name:</p>
<pre><code>sudo mv /home/user/Mycodo /home/user/Mycodo_old
sudo cp -a /var/Mycodo-backups/Mycodo-TIME-COMMIT /home/user/Mycodo
sudo service mycodo restart
sudo /etc/init.d/apache2 restart</code></pre>
<h1 id="troubleshooting">Troubleshooting</h1>
<h2 id="daemon-not-running">Daemon Not Running</h2>
<ul>
<li>Check the Logs: From the <code>[Gear Icon]</code> -&gt; <code>Mycodo Logs</code> page, check the Daemon Log for any errors. If the issue began after an upgrade, also check the Upgrade Log for indications of an issue.</li>
<li>Determine if the Daemon is Running: Execute <code>ps aux | grep '/var/www/mycodo/env/bin/python /var/www/mycodo/mycodo/mycodo_daemon.py'</code> in a terminal and look for an entry to be returned. If nothing is returned, the daemon is not running.</li>
<li>Daemon Lock File: If the daemon is not running, make sure the daemon lock file is deleted at <code>/var/lock/mycodo.pid</code>. The daemon cannot start if the lock file is present.</li>
<li>If a solution could not be found after investigating the above suggestions, submit a <a href="https://github.com/kizniche/Mycodo/issues/new">new Mycodo issue</a> on github.</li>
</ul>
<h2 id="more">More</h2>
<p>Check out the <a href="https://github.com/kizniche/Mycodo/wiki/Diagnosing-Issues">Diagnosing Mycodo Issues Wiki Page</a> on github for more information about diagnosing issues.</p>
<h1 id="appendix">Appendix</h1>
<h2 id="temperature-sensors">Temperature Sensors</h2>
<h3 id="raspberry-pi">Raspberry Pi</h3>
<p>The Raspberry Pi has an integrated temperature sensor on the BCM2835 SoC that measure the temperature of the CPU/GPU. This is the easiest sensor to set up in Mycodo, as it is immediately available to be used.</p>
<h3 id="atlas-scientific-pt-1000">Atlas Scientific PT-1000</h3>
<p>The PT1000 temperature probe is a resistance type thermometer. Where PT stands for platinum and 1000 is the measured resistance of the probe at 0°C in ohms (1k at 0°C).</p>
<h4 id="specifications">Specifications</h4>
<ul>
<li>Accuracy ±(0.15 + (0.002*t))</li>
<li>Probe type: Class A Platinum, RTD (resistance temperature detector)</li>
<li>Cable length: 81cm (32“)</li>
<li>Cable material: Silicone rubber</li>
<li>30mm sensing area (304 SS)</li>
<li>6mm Diameter</li>
<li>BNC Connector</li>
<li>Reaction Time: 90% value in 13 seconds</li>
<li>Probe output: analog</li>
<li>Full temperature sensing range: -200°C to 850°C</li>
<li>Cable max temp 125°C</li>
<li>Cable min temp -55°C</li>
</ul>
<h3 id="ds18b20">DS18B20</h3>
<p>The DS18B20 is a 1-Wire digital temperature sensor from Maxim IC. Each sensor has a unique 64-Bit Serial number, allowing for a huge number of sensors to be used on one data bus (GPIO 4).</p>
<h4 id="specifications-1">Specifications</h4>
<ul>
<li>Usable temperature range: -55 to 125°C (-67°F to +257°F)</li>
<li>9 to 12 bit selectable resolution</li>
<li>Uses 1-Wire interface- requires only one digital pin for communication</li>
<li>Unique 64 bit ID burned into chip</li>
<li>Multiple sensors can share one pin</li>
<li>±0.5°C Accuracy from -10°C to +85°C</li>
<li>Temperature-limit alarm system</li>
<li>Query time is less than 750ms</li>
<li>Usable with 3.0V to 5.5V power/data</li>
</ul>
<h3 id="tmp006-tmp007">TMP006, TMP007</h3>
<p>The TMP006 Breakout can measure the temperature of an object without making contact with it. By using a thermopile to detect and absorb the infrared energy an object is emitting, the TMP006 Breakout can determine how hot or cold the object is.</p>
<h4 id="specifications-2">Specifications</h4>
<ul>
<li>Usable temperature range: -40°C to 125°C</li>
<li>Optimal operating voltage of 3.3V to 5V (tolerant up to 7V max)</li>
</ul>
<h2 id="temperature-humidity-sensors">Temperature, Humidity Sensors</h2>
<h3 id="am2315">AM2315</h3>
<h4 id="specifications-3">Specifications</h4>
<ul>
<li>0-100% humidity readings with 1% (10-90% RH) and 3% (0-10% RH and 90-100% RH) accuracy</li>
<li>-20 to 80°C temperature readings ±0.1°C typical accuracy</li>
<li>3.5 to 5.5V power and I/O</li>
<li>10 mA max current use during conversion (while requesting data)</li>
<li>No more than 0.5 Hz sampling rate (once every 2 seconds)</li>
</ul>
<h3 id="dht11">DHT11</h3>
<h4 id="specifications-4">Specifications</h4>
<ul>
<li>3 to 5V power and I/O</li>
<li>2.5mA max current use during conversion (while requesting data)</li>
<li>20-80% humidity readings with 5% accuracy</li>
<li>0-50°C temperature readings ±2°C accuracy</li>
<li>No more than 1 Hz sampling rate (once every second)</li>
</ul>
<h3 id="dht22-am2302">DHT22, AM2302</h3>
<p>Compared to the DHT11, this sensor is more precise, more accurate and works in a bigger range of temperature/humidity, but its larger and more expensive.</p>
<h4 id="specifications-5">Specifications</h4>
<ul>
<li>0-100% humidity readings with 2% (10-90% RH) and 5% (0-10% RH and 90-100% RH) accuracy</li>
<li>-40 to 80°C temperature readings ±0.5°C accuracy</li>
<li>3 to 5V power and I/O</li>
<li>2.5mA max current use during conversion (while requesting data)</li>
<li>No more than 0.5 Hz sampling rate (once every 2 seconds)</li>
</ul>
<h3 id="htu21d">HTU21D</h3>
<h4 id="specifications-6">Specifications</h4>
<ul>
<li>0-100% humidity readings with 2% (20-80% RH) and 2%-5% (0-20% RH and 80-100% RH) accuracy</li>
<li>Optimum accuracy measurements within 5 to 95% RH</li>
<li>-30 to 90°C temperature readings ±1°C typical accuracy</li>
</ul>
<h3 id="sht1x">SHT1x</h3>
<p>(SHT10, SHT11, SHT15)</p>
<h4 id="specifications-7">Specifications</h4>
<ul>
<li>0-100% humidity readings with 2%-5% (10-90% RH) and 2%-7.5% (0-10% RH and 90-100% RH) accuracy</li>
<li>-40 to 125°C temperature readings ±0.5°C, ±0.4°C, and ±0.3°C typical accuracy (respectively)</li>
<li>2.4 to 5.5V power and I/O</li>
<li>No more than 0.125 Hz sampling rate (once every 8 seconds)</li>
</ul>
<h3 id="sht7x">SHT7x</h3>
<p>(SHT71, SHT75)</p>
<h4 id="specifications-8">Specifications</h4>
<ul>
<li>0-100% humidity readings with 2%-3% (10-90% RH) and 2%-5% (0-10% RH and 90-100% RH) accuracy</li>
<li>-40 to 125°C temperature readings ±0.4°C and ±0.3°C typical accuracy (respectively)</li>
<li>2.4 to 5.5V power and I/O</li>
<li>No more than 0.125 Hz sampling rate (once every 8 seconds)</li>
</ul>
<h2 id="co2-sensors">CO<sub>2</sub> Sensors</h2>
<h3 id="k-30">K-30</h3>
<h4 id="specifications-9">Specifications</h4>
<ul>
<li>0 – 10,000 ppm (0-5,000 ppm within specifications)</li>
<li>Repeatability: ±20 ppm ±1% of measured value within specifications</li>
<li>Accuracy: ±30 ppm ±3% of measured value within specifications</li>
<li>Non-dispersive infrared (NDIR) technology</li>
<li>Sensor life expectancy: &gt; 15 years</li>
<li>Self-diagnostics: complete function check of the sensor module</li>
<li>Warm-up time: &lt; 1 min. (@ full specs &lt; 15 min)</li>
<li>0.5 Hz sampling rate (once every 2 seconds)</li>
</ul>
<h2 id="moisture-sensors">Moisture Sensors</h2>
<h3 id="chirp">Chirp</h3>
<p>The Chirp sensor measures moisture, light, and temperature.</p>
<h4 id="specifications-10">Specifications</h4>
<ul>
<li>Vin: 3 to 5V</li>
<li>I<sup>2</sup>C 7-bit address 0x77</li>
</ul>
<h2 id="pressure-sensors">Pressure Sensors</h2>
<h3 id="bmp085-bmp180">BMP085, BMP180</h3>
<p>The BMP180 is the next-generation of sensors from Bosch, and replaces the BMP085. It is completely identical to the BMP085 in terms of firmware/software/interfacing.</p>
<h4 id="specifications-11">Specifications</h4>
<ul>
<li>300-1100 hPa (9000m to -500m above sea level)</li>
<li>Up to 0.03hPa / 0.25m resolution</li>
<li>-40 to +85°C operational range</li>
<li>±2°C temperature accuracy</li>
<li>Vin: 3 to 5V</li>
<li>Logic: 3 to 5V compliant</li>
<li>I<sup>2</sup>C 7-bit address 0x77</li>
</ul>
<h2 id="luminosity-sensors">Luminosity Sensors</h2>
<h3 id="bh1750">BH1750</h3>
<p>The BH1750 is an I<sup>2</sup>C luminosity sensor that provides a digital value in lux (Lx) over a range of 1 - 65535 lx.</p>
<h3 id="tsl2561">TSL2561</h3>
<p>The TSL2561 SparkFun Luminosity Sensor Breakout is a sophisticated light sensor which has a flat response across most of the visible spectrum. Unlike simpler sensors, the TSL2561 measures both infrared and visible light to better approximate the response of the human eye. And because the TSL2561 is an integrating sensor (it soaks up light for a predetermined amount of time), it is capable of measuring both small and large amounts of light by changing the integration time.</p>
<h4 id="specifications-12">Specifications</h4>
<ul>
<li>Light range: 0.1 - 40k+ Lux</li>
<li>Vin: 3V and a low supply</li>
<li>Max current: 0.6mA.</li>
</ul>
<h2 id="i2c-multiplexers">I<sup>2</sup>C Multiplexers</h2>
<h3 id="tca9548a">TCA9548A</h3>
<p>The TCA9548A I<sup>2</sup>C allows multiple sensors that have the same I<sup>2</sup>C address to be used with mycodo (such as the AM2315). The multiplexer has a selectable address, from 0x70 through 0x77, allowing up to 8 multiplexers to be used at once. With 8 channels per multiplexer, this allows up to 64 devices with the same address to be used.</p>
<h2 id="analog-to-digital-converters">Analog to Digital Converters</h2>
<h3 id="ads1x15">ADS1x15</h3>
<p>(ADS1015, ADS1115)</p>
<h4 id="specifications-13">Specifications</h4>
<ul>
<li>Interface: I<sup>2</sup>C</li>
<li>I<sup>2</sup>C 7-bit addresses 0x48 - 0x4B</li>
<li>Input channels: 2 (differential), 4 (single-ended)</li>
<li>Power: 2.0V to 5.5V</li>
<li>Sample Rate: 1015: 128SPS to 3.3kSPS, 1115: 8SPS to 860SPS</li>
<li>Resolution: 1015: 12-bit, 1115: 16-bit</li>
</ul>
<h3 id="mcp342x">MCP342x</h3>
<p>(MCP3422, MCP3423, MCP3424, MCP3426, MCP3427, MCP3428)</p>
<h4 id="specifications-14">Specifications</h4>
<ul>
<li>Interface: I<sup>2</sup>C</li>
<li>I<sup>2</sup>C 7-bit addresses 0x68 - 0x6F</li>
<li>MCP3422: 2 channel, 12, 14, 16, or 18 bit</li>
<li>MCP3423: 2 channel, 12, 14, 16, or 18 bit</li>
<li>MCP3424: 4 channel, 12, 14, 16, or 18 bit</li>
<li>MCP3426: 2 channel, 12, 14, or 16 bit</li>
<li>MCP3427: 2 channel, 12, 14, or 16 bit</li>
<li>MCP3428: 4 channel, 12, 14, or 16 bit</li>
</ul>
</body>
</html>
