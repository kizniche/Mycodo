

MYCODO MANUAL



TABLE OF CONTENTS


About Mycodo

Frequently Asked Questions

Upgrading

Settings

-   General Settings
-   Relay Usage Settings
-   Users
-   User Roles
-   Alert Settings
-   Camera Settings

Controllers

-   Sensors
-   Relays
-   PIDs
-   Timers
-   LCDs

Controller Functions

-   Conditional Statements
-   Methods

PID Tuning

-   PID Control Theory
-   Quick Setup Examples
-   Exact-Temperature Regulation
-   High-Temperature Regulation

Miscellaneous

-   Graphs
-   Camera
-   Relay Usage
-   System Backup
-   System Restore

Troubleshooting

-   Daemon Not Running
-   More

Sensor and Device Setup

Sensor Interfaces

-   1-Wire
-   GPIO
-   UART
-   I2C
-   Edge Detection

Device Setup

-   I2C Multiplexers
-   Analog to Digital Converters

Device Specific Information

Temperature Sensors

-   Raspberry Pi
-   Atlas Scientific PT-1000
-   DS18B20
-   TMP006, TMP007

Temperature, Humidity Sensors

-   AM2315
-   DHT11
-   DHT22, AM2302
-   HTU21D
-   SHT1x
-   SHT7x

CO2 Sensors

-   K-30

Moisture Sensors

-   Chirp

pH Sensors

-   Atlas Scientific pH

Pressure Sensors

-   BME280
-   BMP085, BMP180

Luminosity Sensors

-   BH1750
-   TSL2561

Analog to Digital Converters

-   ADS1x15
-   MCP342x

Diagrams

-   DHT11 Diagrams
-   DS18B20 Diagrams
-   Raspberry Pi and Relay Diagrams

------------------------------------------------------------------------



ABOUT MYCODO


Mycodo is a remote monitoring and automated regulation system with a
focus on modulating environmental conditions. It was built to run on the
Raspberry Pi (versions Zero, 1, 2, and 3) and aims to be easy to install
and set up.

The core system coordinates a diverse set of responses to sensor
measurements, including actions such as camera captures, email
notifications, relay activation/deactivation, regulation with PID
control, and more. Mycodo has been used for cultivating gourmet
mushrooms, cultivating plants, culturing microorganisms, maintaining
honey bee apiary homeostasis, incubating snake eggs and young animals,
aging cheeses, fermenting foods, maintaining aquatic systems, and more.

A proportional-derivative-integral (PID) controller is a control loop
feedback mechanism used throughout industry for controlling systems. It
efficiently brings a measurable condition, such as the temperature, to a
desired state and maintains it there with little overshoot and
oscillation. A well-tuned PID controller will raise to the setpoint
quickly, have minimal overshoot, and maintain the setpoint with little
oscillation.



FREQUENTLY ASKED QUESTIONS


_Where do I even begin?_

Here is how I generally set up Mycodo to monitor and regulate:

1.  Determine what environmental condition you want to measure
    or regulate. Consider the devices that must be coupled to achieve
    this. For instance, temperature regulation require a temperature
    sensor and an electric heater and/or electric air conditioner.
2.  Determine what relays you will need to power your electric devices.
    The Raspberry Pi is capable of directly switching relays (using a
    3.3-volt signal), although opto-isolating the circuit is advisable.
    Be careful when selecting a relay not to exceed the current draw of
    the Raspberry Pi’s PGIO.
3.  See the Device Specific Information for information about what
    sensors are supported. Acquire one or more of these sensors and
    relays and connect them to the Raspberry Pi according to the
    manufacturer’s instructions.
4.  On the Sensors page, create a new sensor, using the dropdown to
    select the correct sensor. Configure the sensor with the correct
    communication pins, etc. and save. Activate the sensor to begin
    recording measurements.
5.  Go to the Data -> Live Measurements page to ensure there is recent
    data being acquired from the sensor.
6.  On the Relay -> Relays page, add a relay and configure the GPIO pin
    that switches it, whether the relay switches On when the signal is
    HIGH or LOW, and what state (On or Off) to set the relay when
    Mycodo starts.
7.  Test the relay by switching it On and Off from the Relay -> Relays
    page and make sure the device connected to the relay turns On when
    you select “On”, and Off when you select “Off”.
8.  On the PID -> PID Controllers page, create a PID controller with the
    appropriate sensor, measurement, relay, and other parameters. Refer
    to the Quick Setup Examples for setting up and tuning a
    PID controller.
9.  On the Data -> Live Graphs page, create a graph that includes the
    sensor measurement, the relay that is being used by the PID, and the
    PID setpoint. This provides a good visualization for tuning and
    adjusting the system.

------------------------------------------------------------------------

_Why is there only one FAQ?_

Good question.

------------------------------------------------------------------------



UPGRADING


If you already have Mycodo installed (version >= 4.0.0), you can perform
an upgrade to the latest release on github by either using the Upgrade
option in the web UI (recommended) or by issuing the following command
in a terminal. A log of the upgrade process is created at
/var/log/mycodo/mycodoupgrade.log

sudo /bin/bash ~/Mycodo/mycodo/scripts/upgrade_commands.sh upgrade



SETTINGS


The settings menu, accessed by selecting the gear icon in the top-right,
then the Configure link, is a general area for various system-wide
configuration options.


General Settings

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Lang Set
  uage the
       lang
       uage
       that
       will
       be
       disp
       laye
       d
       in
       the
       web
       user
       inte
       rfac
       e.

  Forc Requ
  e    ire
  HTTP web
  S    brow
       sers
       to
       use
       SSL/
       HTTP
       S.
       Any
       requ
       est
       to
       http
       ://
       will
       be
       redi
       rect
       ed
       to
       http
       s://
       .

  Hide Hide
  succ all
  ess  succ
  aler ess
  ts   aler
       t
       boxe
       s
       that
       appe
       ar
       at
       the
       top
       of
       the
       page
       .

  Hide Hide
  info all
  aler info
  ts   aler
       t
       boxe
       s
       that
       appe
       ar
       at
       the
       top
       of
       the
       page
       .

  Hide Hide
  warn all
  ing  warn
  aler ing
  ts   aler
       t
       boxe
       s
       that
       appe
       ar
       at
       the
       top
       of
       the
       page
       .

  Opt- Turn
  out  off
  of   send
  stat ing
  isti anon
  cs   ymou
       s
       usag
       e
       stat
       isti
       cs.
       Plea
       se
       cons
       ider
       that
       this
       help
       s
       the
       deve
       lopm
       ent
       to
       leav
       e
       on.
  ---------


Relay Usage Settings

In order to calculate accurate relay usage statistics, a few
characteristics of your electrical system needs to be know. These
variables should describe the characteristics of the electrical system
being used by the relays to operate electrical devices. Note: Proper
relay usage calculations also rely on the correct current draw to be set
for each relay (see Relay Settings).

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Volt Alte
  age  rnat
       ing
       curr
       ent
       (AC)
       volt
       age
       that
       is
       swit
       ched
       by
       the
       rela
       ys.
       This
       is
       usua
       lly
       120
       or
       240.

  Cost This
  per  is
  kWh  how
       much
       you
       pay
       per
       kWh.

  Curr This
  ency is
  Unit the
       unit
       used
       for
       the
       curr
       ency
       that
       pays
       for
       elec
       tric
       ity.

  Day  This
  of   is
  Mont the
  h    day
       of
       the
       mont
       h
       (1-3
       0)
       that
       the
       elec
       tric
       ity
       mete
       r
       is
       read
       (whi
       ch
       will
       corr
       espo
       nd
       to
       the
       elec
       tric
       al
       bill
       ).
  ---------


Users

Mycodo requires at least one Admin user for the login system to be
enabled. If there isn’t an Admin user, the web server will redirect to
an Admin Creation Form. This is the first page you see when starting
Mycodo for the first time. After an Admin user has been created,
additional users may be created from the User Settings page.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  User Choo
  name se
       a
       user
       name
       that
       is
       betw
       een
       2
       and
       64
       char
       acte
       rs.
       The
       user
       name
       is
       case
       inse
       nsit
       ive
       (all
       user
       name
       s
       are
       conv
       erte
       d
       to
       lowe
       r-ca
       se).

  Emai The
  l    emai
       l
       asso
       ciat
       ed
       with
       the
       new
       acco
       unt.

  Pass Choo
  word se
  /Rep a
  eat  pass
       word
       that
       is
       betw
       een
       6
       and
       64
       char
       acte
       rs
       and
       only
       cont
       ain
       lett
       ers,
       numb
       ers,
       and
       symb
       ols.

  Role Role
       s
       are
       a
       way
       of
       impo
       sing
       acce
       ss
       rest
       rict
       ions
       on
       user
       s,
       to
       eith
       er
       allo
       w
       or
       deny
       acti
       ons.
       See
       the
       tabl
       e
       belo
       w
       for
       expl
       anat
       ions
       of
       the
       four
       defa
       ult
       Role
       s.
  ---------


User Roles

Roles define the permissions of each user. There are 4 default roles
that determine if a user can view or edit particular areas of Mycodo.
Custom roles may be created, but these four roles may not be modified or
deleted.

  Role               Admin   Editor   Monitor   Guest
  ------------------ ------- -------- --------- -------
  Edit Users         X                          
  Edit Controllers   X       X                  
  Edit Settings      X       X                  
  View Settings      X       X        X         
  View Camera        X       X        X         
  View Stats         X       X        X         
  View Logs          X       X        X         

1The Edit Controllers permission protects the editing of Graphs, LCDs,
Methods, PIDs, Relays, Sensors, and Timers.

2The View Stats permission protects the viewing of usage statistics and
the System Info and Relay Usage pages.


Alert Settings

Alert settings set up the credentials for sending email notifications.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  SMTP The
  Host SMTP
       serv
       er
       to
       use
       to
       send
       emai
       ls
       from
       .

  SMTP Port
  Port to
       comm
       unic
       ate
       with
       the
       SMTP
       serv
       er
       (465
       for
       SSL,
       587
       for
       TSL)
       .

  Enab Chec
  le   k
  SSL  to
       emab
       le
       SSL,
       unch
       eck
       to
       enab
       le
       TSL.

  SMTP The
  User user
       name
       to
       send
       the
       emai
       l
       from
       .
       This
       can
       be
       just
       a
       name
       or
       the
       enti
       re
       emai
       l
       addr
       ess.

  SMTP The
  Pass pass
  word word
       for
       the
       user
       .

  From What
  Emai the
  l    from
       emai
       l
       addr
       ess
       be
       set
       as.
       This
       shou
       ld
       be
       the
       actu
       al
       emai
       l
       addr
       ess
       for
       this
       user
       .

  Max  Set
  emai the
  ls   maxi
  (per mum
  hour numb
  )    er
       of
       emai
       ls
       that
       can
       be
       sent
       per
       hour
       .
       If
       more
       noti
       fica
       tion
       s
       are
       trig
       gere
       d
       with
       in
       the
       hour
       and
       this
       numb
       er
       has
       been
       reac
       hed,
       the
       noti
       fica
       tion
       s
       will
       be
       disc
       arde
       d.
  ---------


Camera Settings

Many cameras can be used simultaneously with Mycodo. Each camera needs
to be set up in the camera settings, then may be used throughout the
software. Note that not every option (such as Hue or White Balance) may
be able to be used with your particular camera, due to manufacturer
differences in hardware and software.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Type Sele
       ct
       whet
       her
       the
       came
       ra
       is a
       Rasp
       berr
       y
       Pi
       Came
       ra
       or a
       USB
       came
       ra.

  Libr Sele
  ary  ct
       whic
       h
       libr
       ary
       to
       use
       to
       comm
       unic
       ate
       with
       the
       came
       ra.
       The
       Rasp
       berr
       y
       Pi
       Came
       ra
       uses
       pica
       mera
       (and
       pote
       ntia
       lly
       open
       cv),
       and
       USB
       came
       ras
       shou
       ld
       be
       set
       to
       open
       cv.

  Open Any
  CV   devi
  Devi ces
  ce   dete
       cted
       by
       open
       cv
       will
       popu
       late
       this
       drop
       down
       list
       .
       If
       ther
       e
       are
       no
       valu
       es
       in
       this
       list
       ,
       none
       were
       dete
       cted
       .
       If
       you
       have
       mult
       iple
       open
       cv
       devi
       ces
       dete
       cted
       ,
       try
       sett
       ing
       the
       came
       ra
       to
       each
       devi
       ce
       and
       take
       a
       phot
       o
       to
       dete
       rmin
       e
       whic
       h
       came
       ra
       is
       asso
       ciat
       ed
       with
       whic
       h
       devi
       ce.

  Rela This
  y    rela
  ID   y
       will
       turn
       on
       duri
       ng
       the
       capt
       ure
       of
       any
       stil
       l
       imag
       e
       (whi
       ch
       incl
       udes
       time
       laps
       es).

  Rota The
  te   numb
  Imag er
  e    of
       degr
       ees
       to
       rota
       te
       the
       imag
       e.

  …    Imag
       e
       Widt
       h,
       Imag
       e
       Heig
       ht,
       Brig
       htne
       ss,
       Cont
       rast
       ,
       Expo
       sure
       ,
       Gain
       ,
       Hue,
       Satu
       rati
       on,
       Whit
       e
       Bala
       nce.
       Thes
       e
       opti
       ons
       are
       self
       -exp
       lana
       tory
       .
       Not
       all
       opti
       ons
       will
       work
       with
       all
       came
       ras.

  Pre  A
  Comm comm
  and  and
       to
       exec
       ute
       (as
       user
       myco
       do)
       befo
       re
       a
       stil
       l
       imag
       e
       is
       capt
       ured
       .

  Post A
  Comm comm
  and  and
       to
       exec
       ute
       (as
       user
       myco
       do)
       afte
       r
       a
       stil
       l
       imag
       e
       is
       capt
       ured
       .

  Flip Flip
  hori ,
  zont or
  ally mirr
       or,
       the
       imag
       e
       hori
       zont
       ally
       .

  Flip Flip
  vert ,
  ical or
  ly   mirr
       or,
       the
       imag
       e
       vert
       ical
       ly.
  ---------



CONTROLLERS


Controllers are essentially modules that can be used to perform
functions or communicate with other parts of Mycodo. Each controller
performs a specific task or group of related tasks. There are also
Controller Functions, which are larger functions of a controller or
controllers and have been given their own sections.


Sensors

Sensors measure environmental conditions, which will be stored in an
influx database. This database will provide recent measurement for
Conditional Statements or PID Controllers to operate from, among other
uses.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Acti Afte
  vate r
       the
       sens
       or
       has
       been
       prop
       erly
       conf
       igur
       ed,
       acti
       vati
       on
       begi
       ns
       acqu
       irin
       g
       meas
       urem
       ents
       from
       the
       sens
       or.
       Any
       acti
       vate
       d
       cond
       itio
       nal
       stat
       emen
       ts
       will
       now
       bein
       g
       oper
       atin
       g.

  Deac Deac
  tiva tiva
  te   tion
       stop
       s
       meas
       urem
       ents
       from
       bein
       g
       acqu
       ired
       from
       the
       sens
       or.
       All
       asso
       ciat
       ed
       cond
       itio
       nal
       stat
       emen
       ts
       will
       ceas
       e
       to
       oper
       ate.

  Save Save
       the
       curr
       ent
       conf
       igur
       atio
       n
       ente
       red
       into
       the
       inpu
       t
       boxe
       s
       for
       a
       part
       icul
       ar
       sens
       or.

  Dele Dele
  te   te
       a
       part
       icul
       ar
       sens
       or.

  Up/D Move
  own  a
       part
       icul
       ar
       sens
       or
       up
       or
       down
       in
       the
       orde
       r
       disp
       laye
       d.

  Loca Depe
  tion ndin
       g
       on
       what
       sens
       or
       is
       bein
       g
       used
       ,
       you
       will
       need
       to
       eith
       er
       sele
       ct
       a
       seri
       al
       numb
       er
       (DS1
       8B20
       temp
       erat
       ure
       sens
       or),
       a
       GPIO
       pin
       (in
       the
       case
       of
       sens
       ors
       read
       by a
       GPIO
       ),
       or
       an
       I2C
       addr
       ess.
       and
       chan
       nel
       if
       usin
       g
       the
       TCA9
       548A
       I2C
       mult
       iple
       xer.

  I2C  The
  Bus  bus
       to
       be
       used
       to
       comm
       unic
       ate
       with
       the
       I2C
       addr
       ess.
       If
       you’
       re
       usin
       g
       an
       I2C
       mult
       iple
       xer
       that
       prov
       ides
       mult
       iple
       buse
       s,
       this
       allo
       ws
       you
       to
       sele
       ct
       whic
       h
       bus
       the
       sens
       or
       is
       conn
       ecte
       d
       to.

  Peri Afte
  od   r
       the
       sens
       or
       is
       succ
       essf
       ully
       read
       and
       a
       data
       base
       entr
       y
       is
       made
       ,
       this
       is
       the
       dura
       tion
       of
       time
       wait
       ed
       unti
       l
       the
       sens
       or
       is
       meas
       ured
       agai
       n.

  Pre  If
  Rela you
  y    requ
       ire
       a
       rela
       y
       to
       be
       acti
       vate
       d
       befo
       re
       a
       meas
       urem
       ent
       is
       made
       (for
       inst
       ance
       ,
       if
       you
       have
       a
       pump
       that
       extr
       acts
       air
       to a
       cham
       ber
       wher
       e
       the
       sens
       or
       resi
       des)
       ,
       this
       is
       the
       rela
       y
       numb
       er
       that
       will
       be
       acti
       vate
       d.
       The
       rela
       y
       will
       be
       acti
       vate
       d
       for
       a
       dura
       tion
       defi
       ned
       by
       the
       Pre
       Dura
       tion
       ,
       then
       once
       the
       rela
       y
       turn
       s
       off,
       a
       meas
       urem
       ent
       by
       the
       sens
       or
       is
       made
       .

  Pre  This
  Rela is
  y    the
  Dura dura
  tion tion
       of
       time
       that
       the
       Pre
       Rela
       y
       runs
       for
       befo
       re
       the
       sens
       or
       meas
       urem
       ent
       is
       obta
       ined
       .

  Edge Edge
       sens
       ors
       only
       :
       Sele
       ct
       whet
       her
       the
       Risi
       ng
       or
       Fall
       ing
       (or
       both
       )
       edge
       s
       of a
       chan
       ging
       volt
       age
       are
       dete
       cted
       .
       A
       numb
       er
       of
       devi
       ces
       to
       do
       this
       when
       in-l
       ine
       with
       a
       circ
       uit
       supp
       lyin
       g
       a
       3.3-
       volt
       inpu
       t
       sign
       al
       to a
       GPIO
       ,
       such
       as
       simp
       le
       mech
       anic
       al
       swit
       ch,
       a
       butt
       on,
       a
       magn
       et
       (ree
       d/ha
       ll)
       sens
       or,
       a
       PIR
       moti
       on
       dete
       ctor
       ,
       and
       more
       .

  Boun Edge
  ce   sens
  Time ors
  (ms) only
       :
       This
       is
       the
       numb
       er
       of
       mill
       isec
       onds
       to
       boun
       ce
       the
       inpu
       t
       sign
       al.
       This
       is
       comm
       only
       call
       ed
       debo
       unci
       ng
       a
       sign
       al.
       and
       may
       be
       nece
       ssar
       y
       if
       usin
       g
       a
       mech
       anic
       al
       circ
       uit.

  Rese Edge
  t    sens
  Peri ors
  od   only
       :
       This
       is
       the
       peri
       od
       of
       time
       afte
       r
       an
       edge
       dete
       ctio
       n
       that
       anot
       her
       edge
       will
       not
       be
       reco
       rded
       .
       This
       enab
       les
       devi
       ces
       such
       as
       PIR
       moti
       on
       sens
       ors
       that
       may
       stay
       acti
       vate
       d
       for
       long
       er
       peri
       ods
       of
       time
       .

  Mult If
  iple conn
  xer  ecte
  (MX) d
       to
       the
       TCA9
       548A
       I2C
       mult
       iple
       xer,
       sele
       ct
       what
       the
       I2C
       addr
       ess
       of
       the
       mult
       iple
       xer
       is.

  Mx   If
  I2C  conn
  Bus  ecte
       d
       to
       the
       TCA9
       548A
       I2C
       mult
       iple
       xer,
       sele
       ct
       the
       I2C
       bus
       the
       mult
       iple
       xer
       is
       conn
       ecte
       d
       to.

  Mx   If
  Chan conn
  nel  ecte
       d
       to
       the
       TCA9
       548A
       I2C
       mult
       iple
       xer,
       sele
       ct
       the
       chan
       nel
       of
       the
       mult
       iple
       xer
       the
       devi
       ce
       is
       conn
       ecte
       d
       to.

  Meas Anal
  urem og-t
  ent  o-di
       gita
       l
       conv
       erte
       r
       only
       :
       The
       type
       of
       meas
       urem
       ent
       bein
       g
       acqu
       ired
       by
       the
       ADC.
       For
       inst
       ance
       ,
       if
       the
       resi
       stan
       ce
       of a
       phot
       ocel
       l
       is
       bein
       g
       meas
       ured
       thro
       ugh
       a
       volt
       age
       divi
       der,
       this
       meas
       urem
       ent
       woul
       d
       be
       “lig
       ht”.

  Unit Anal
  s    og-t
       o-di
       gita
       l
       conv
       erte
       r
       only
       :
       This
       is
       the
       unit
       of
       the
       meas
       urem
       ent.
       With
       the
       abov
       e
       exam
       ple
       of
       “lig
       ht”
       as
       the
       meas
       urem
       ent,
       the
       unit
       may
       be
       “lux
       ”
       or
       “int
       ensi
       ty”.

  Chan Anal
  nel  og-t
       o-di
       gita
       l
       conv
       erte
       r
       only
       :
       This
       is
       the
       chan
       nel
       to
       obta
       in
       the
       volt
       age
       meas
       urem
       ent
       from
       the
       ADC.

  Gain Anal
       og-t
       o-di
       gita
       l
       conv
       erte
       r
       only
       :
       set
       the
       gain
       when
       acqu
       irin
       g
       the
       meas
       urem
       ent.

  Volt Anal
  s    og-t
  Min  o-di
       gita
       l
       conv
       erte
       r
       only
       :
       What
       is
       the
       mini
       mum
       volt
       age
       to
       use
       when
       scal
       ing
       to
       prod
       uce
       the
       unit
       valu
       e
       for
       the
       data
       base
       .
       For
       inst
       ance
       ,
       if
       your
       ADC
       is
       not
       expe
       cted
       to
       meas
       ure
       belo
       w
       0.2
       volt
       s
       for
       your
       part
       icul
       ar
       circ
       uit,
       set
       this
       to
       “0.2
       ”.

  Volt Anal
  s    og-t
  Max  o-di
       gita
       l
       conv
       erte
       r
       only
       :
       This
       is
       simi
       lar
       to
       the
       Min
       opti
       on
       abov
       e,
       howe
       ver
       it
       is
       sett
       ing
       the
       ceil
       ing
       to
       the
       volt
       age
       rang
       e.
       Unit
       s
       Min
       Anal
       og-t
       o-di
       gita
       l
       conv
       erte
       r
       only
       :
       This
       valu
       e
       will
       be
       the
       lowe
       r
       valu
       e
       of a
       rang
       e
       that
       will
       use
       the
       Min
       and
       Max
       Volt
       ages
       ,
       abov
       e,
       to
       prod
       uce
       a
       unit
       outp
       ut.
       For
       inst
       ance
       ,
       if
       your
       volt
       age
       rang
       e
       is
       0.0
       -
       1.0
       volt
       s,
       and
       the
       unit
       rang
       e
       is 1
       -
       60,
       and
       a
       volt
       age
       of
       0.5
       is
       meas
       ured
       ,
       in
       addi
       tion
       to
       0.5
       bein
       g
       stor
       ed
       in
       the
       data
       base
       ,
       30
       will
       be
       stor
       ed
       as
       well
       .
       This
       enab
       les
       crea
       ting
       cali
       brat
       ed
       scal
       es
       to
       use
       with
       your
       part
       icul
       ar
       circ
       uit.

  Unit Anal
  s    og-t
  Max  o-di
       gita
       l
       conv
       erte
       r
       only
       :
       This
       is
       simi
       lar
       to
       the
       Min
       opti
       on
       abov
       e,
       howe
       ver
       it
       is
       sett
       ing
       the
       ceil
       ing
       to
       the
       unit
       rang
       e.
  ---------

Sensor Verification

Sensor verification was introduced in an earlier version and was broken
when the system moved to its new software framework. It was a great
feature, and it’s planned to be integrated into the latest version.

This allows the verification of a sensor’s measurement with another
sensor’s measurement. This feature is best utilized when you have two
sensors in the same location (ideally as close as possible). One sensor
(host) should be set up to use the other sensor (slave) to verify. The
host sensor should be used to operate the PID, as one feature of the
verification is the ability to disable the PID if the difference between
measurements is not within the range specified.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  GPIO This
       is
       the
       sens
       or
       that
       will
       be
       used
       to
       veri
       fy
       the
       sens
       or
       meas
       urem
       ent.
       The
       sens
       or
       will
       be
       read
       dire
       ctly
       afte
       r
       the
       firs
       t
       sens
       or’s
       meas
       urem
       ent
       to
       veri
       fy
       whet
       her
       the
       sens
       ors
       have
       simi
       lar
       meas
       urem
       ents
       .

  Diff This
  eren is
  ce   the
       maxi
       mum
       meas
       ured
       meas
       urem
       ent
       diff
       eren
       ce
       betw
       een
       the
       two
       sens
       ors
       befo
       re
       an
       acti
       on
       is
       trig
       gere
       d
       (eit
       her
       noti
       fy
       by
       emai
       l
       or
       prev
       ent
       PID
       from
       oper
       atin
       g;
       more
       belo
       w).

  Noti If
  fica the
  tion meas
       urem
       ents
       of
       the
       two
       sens
       ors
       diff
       er
       by
       more
       than
       the
       set
       _Dif
       fere
       nce_
       ,
       an
       emai
       l
       will
       be
       sent
       to
       the
       addr
       ess
       in
       the
       _Not
       ific
       atio
       n_
       fiel
       d.

  Stop If
  PID  the
       meas
       urem
       ents
       of
       the
       two
       sens
       ors
       diff
       er
       by
       more
       than
       the
       set
       _Dif
       fere
       nce_
       ,
       the
       PID
       cont
       roll
       er
       will
       turn
       off.
  ---------


Relays

Relays are electromechanical or solid-state devices that enable a small
voltage signal (such as from a microprocessor) to activate a much larger
voltage, without exposing the low -voltage system to the dangers of the
higher voltage.

Relays must be properly set up before PID regulation can be achieved.
Add and configure relays in the Relay tab. Set the “GPIO Pin” to the BCM
GPIO number of each pin that activates each relay. _On Trigger_ should
be set to the signal that activates the relay (the device attached to
the relay turns on). If your relay activates when the potential across
the coil is 0-volts, set _On Trigger_ to “Low”, otherwise if your relay
activates when the potential across the coil is 3.3-volts (or whatever
switching voltage you are using, if not being driven by the GPIO pin),
set it to “High”.

When a relay is initially added, the background of the new relay will be
yellow, indicating it is not configured. When properly configured, it
will either turn green, indicating the relay is activated (device is
on), or red, indicating the relay is inactivated (device is off).

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  GPIO This
  Pin  is
       the
       GPIO
       that
       will
       be
       the
       sign
       al
       to
       the
       rela
       y.

  Curr The
  ent  is
  Draw the
  (amp amou
  s)   nt
       of
       curr
       ent
       the
       devi
       ce
       powe
       red
       by
       the
       rela
       y
       draw
       s.
       Note
       :
       this
       valu
       e
       shou
       ld
       be
       calc
       ulat
       ed
       base
       d
       on
       the
       volt
       age
       set
       in
       the
       Rela
       y
       Usag
       e
       Sett
       ings
       .

  On   This
  Trig is
  ger  the
       stat
       e
       of
       the
       GPIO
       to
       sign
       al
       the
       rela
       y
       to
       turn
       the
       devi
       ce
       on.
       HIGH
       will
       send
       a
       3.3-
       volt
       sign
       al
       and
       LOW
       will
       send
       a
       0-vo
       lt
       sign
       al.
       If
       you
       rela
       y
       comp
       lete
       s
       the
       circ
       uit
       (and
       the
       devi
       ce
       powe
       rs
       on)
       when
       a
       3.3-
       volt
       sign
       al
       is
       sent
       ,
       then
       set
       this
       to
       HIGH
       .
       If
       the
       devi
       ce
       powe
       rs
       when
       a
       0-vo
       lt
       sign
       al
       is
       sent
       ,
       set
       this
       to
       LOW.

  Star This
  t    spec
  Stat ifie
  e    s
       whet
       her
       the
       rela
       y
       shou
       ld
       be
       ON
       or
       OFF
       when
       myco
       do
       init
       iall
       y
       star
       ts.

  Seco This
  nds  is a
  to   way
  turn to
  On   turn
       a
       rela
       y
       on
       for
       a
       spec
       ific
       dura
       tion
       of
       time
       .
       This
       can
       be
       usef
       ul
       for
       test
       ing
       the
       rela
       ys
       and
       powe
       red
       devi
       ces
       or
       the
       meas
       ured
       effe
       cts
       a
       devi
       ce
       may
       have
       on
       an
       envi
       ronm
       enta
       l
       cond
       itio
       n.
  ---------


PIDs

A proportional-derivative-integral (PID) controller is a control loop
feedback mechanism used throughout industry for controlling systems. It
efficiently brings a measurable condition, such as the temperature, to a
desired state and maintains it there with little overshoot and
oscillation. A well-tuned PID controller will raise to the setpoint
quickly, have minimal overshoot, and maintain the setpoint with little
oscillation.

PID settings may be changed while the PID is activated and the new
settings will take effect immediately. If settings are changed while the
controller is paused, the values will be used once the controller
resumes operation.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Acti Turn
  vate a
  /Dea part
  ctiv icul
  ate  ar
       PID
       cont
       roll
       er
       on
       or
       off.

  Paus When
  e    paus
       ed,
       the
       PID
       will
       not
       turn
       on
       the
       asso
       ciat
       ed
       rela
       ys,
       and
       sett
       ings
       can
       be
       chan
       ged
       with
       out
       losi
       ng
       curr
       ent
       PID
       outp
       ut
       valu
       es.

  Hold When
       held
       ,
       the
       PID
       will
       turn
       on
       the
       asso
       ciat
       ed
       rela
       ys,
       and
       sett
       ings
       can
       be
       chan
       ged
       with
       out
       losi
       ng
       curr
       ent
       PID
       outp
       ut
       valu
       es.

  Resu Resu
  me   me
       a
       PID
       cont
       roll
       er
       from
       bein
       g
       held
       or
       paus
       ed.

  Setp This
  oint is
       the
       spec
       ific
       poin
       t
       you
       woul
       d
       like
       the
       envi
       ronm
       ent
       to
       be
       rega
       ulte
       d
       at.
       For
       exam
       ple,
       if
       you
       woul
       d
       like
       the
       humi
       dity
       regu
       late
       d
       to
       60%,
       ente
       r
       60.

  Dire This
  ctio is
  n    the
       dire
       ctio
       n
       that
       you
       wish
       to
       regu
       late
       .
       For
       exam
       ple,
       if
       you
       only
       requ
       ire
       the
       temp
       erat
       ure
       to
       be
       rais
       ed,
       set
       this
       to
       “Up,
       ”
       but
       if
       you
       requ
       ire
       regu
       lati
       on
       up
       and
       down
       ,
       set
       this
       to
       “Bot
       h.”

  Peri This
  od   is
       the
       dura
       tion
       betw
       een
       when
       the
       PID
       rela
       y
       turn
       s
       off
       amd
       when
       the
       sens
       or
       take
       s
       anot
       her
       meas
       urem
       ent,
       the
       PID
       is
       upda
       ted,
       and
       the
       rela
       y
       is
       turn
       ed
       on
       agai
       n
       for
       anot
       her
       dura
       tion
       .

  Max  The
  Age  time
       (in
       seco
       nds)
       that
       the
       sens
       or
       meas
       urem
       ent
       age
       is
       requ
       ired
       to
       be
       less
       than
       .
       If
       the
       meas
       urem
       ent
       is
       not
       youn
       ger
       than
       this
       age,
       the
       meas
       urem
       ent
       is
       thro
       wn
       out
       and
       the
       PID
       will
       not
       actu
       ate
       the
       rela
       y.
       This
       is a
       safe
       ty
       meas
       ure
       to
       ensu
       re
       the
       PID
       is
       only
       usin
       g
       rece
       nt
       meas
       urem
       ents
       .

  Rais This
  e    is
  Rela the
  y    rela
       y
       that
       will
       caus
       e
       the
       part
       icul
       ar
       envi
       ronm
       enta
       l
       cond
       itio
       n
       to
       rise
       .
       In
       the
       case
       of
       rais
       ing
       the
       temp
       erat
       ure,
       this
       may
       be a
       heat
       ing
       pad
       or
       coil
       .

  Min  This
  Dura is
  tion the
  (rai mini
  se)  mum
       that
       the
       PID
       outp
       ut
       must
       be
       befo
       re
       the
       Up
       Rela
       y
       turn
       s
       on.
       If
       the
       PID
       outp
       ut
       exce
       eds
       this
       mini
       mum,
       the
       Up
       Rela
       y
       will
       turn
       on
       for
       the
       PID
       outp
       ut
       numb
       er
       of
       seco
       nds.

  Max  This
  Dura is
  tion the
  (rai maxi
  se)  mum
       dura
       tion
       the
       Up
       Rela
       y
       is
       allo
       wed
       to
       turn
       on
       for.
       If
       the
       PID
       outp
       ut
       exce
       eds
       this
       numb
       er,
       the
       Up
       Rela
       y
       will
       turn
       on
       for
       no
       grea
       ter
       than
       this
       dura
       tion
       of
       time
       .

  Lowe This
  r    is
  Rela the
  y    rela
       y
       that
       will
       caus
       e
       the
       part
       icul
       ar
       envi
       ronm
       enta
       l
       cond
       itio
       n
       to
       lowe
       r.
       In
       the
       case
       of
       lowe
       ring
       the
       CO₂,
       this
       may
       be
       an
       exha
       ust
       fan.

  Min  This
  Dura is
  tion the
  (low mini
  er)  mum
       that
       the
       PID
       outp
       ut
       must
       be
       befo
       re
       the
       Down
       Rela
       y
       turn
       s
       on.
       If
       the
       PID
       outp
       ut
       exce
       eds
       this
       mini
       mum,
       the
       Down
       Rela
       y
       will
       turn
       on
       for
       the
       PID
       outp
       ut
       numb
       er
       of
       seco
       nds.

  Max  This
  Dura is
  tion the
  (low maxi
  er)  mum
       dura
       tion
       the
       Down
       Rela
       y
       is
       allo
       wed
       to
       turn
       on
       for.
       if
       the
       PID
       outp
       ut
       exce
       eds
       this
       numb
       er,
       the
       Down
       Rela
       y
       will
       turn
       on
       for
       no
       grea
       ter
       than
       this
       dura
       tion
       of
       time
       .

  KP   Prop
       orti
       onal
       coef
       fici
       ent
       (non
       -neg
       ativ
       e).
       Acco
       unts
       for
       pres
       ent
       valu
       es
       of
       the
       erro
       r.
       For
       exam
       ple,
       if
       the
       erro
       r
       is
       larg
       e
       and
       posi
       tive
       ,
       the
       cont
       rol
       outp
       ut
       will
       also
       be
       larg
       e
       and
       posi
       tive
       .

  KI   Inte
       gral
       coef
       fici
       ent
       (non
       -neg
       ativ
       e).
       Acco
       unts
       for
       past
       valu
       es
       of
       the
       erro
       r.
       For
       exam
       ple,
       if
       the
       curr
       ent
       outp
       ut
       is
       not
       suff
       icie
       ntly
       stro
       ng,
       the
       inte
       gral
       of
       the
       erro
       r
       will
       accu
       mula
       te
       over
       time
       ,
       and
       the
       cont
       roll
       er
       will
       resp
       ond
       by
       appl
       ying
       a
       stro
       nger
       acti
       on.

  KD   Deri
       vati
       ve
       coef
       fici
       ent
       (non
       -neg
       ativ
       e).
       Acco
       unts
       for
       pred
       icte
       d
       futu
       re
       valu
       es
       of
       the
       erro
       r,
       base
       d
       on
       its
       curr
       ent
       rate
       of
       chan
       ge.

  Inte The
  grat mini
  or   mum
  Min  allo
       wed
       inte
       grat
       or
       valu
       e,
       for
       calc
       ulat
       ing
       Ki_t
       otal
       :
       (Ki_
       tota
       l
       = Ki
       *
       inte
       grat
       or;
       and
       PID
       outp
       ut
       =
       Kp_t
       otal
       +
       Ki_t
       otal
       +
       Kd_t
       otal
       )

  Inte The
  grat maxi
  or   mum
  Max  allo
       wed
       inte
       grat
       or
       valu
       e,
       for
       calc
       ulat
       ing
       Ki_t
       otal
       :
       (Ki_
       tota
       l
       = Ki
       *
       inte
       grat
       or;
       and
       PID
       outp
       ut
       =
       Kp_t
       otal
       +
       Ki_t
       otal
       +
       Kd_t
       otal
       )
  ---------


Timers

Timers enable a relay to be manipulated after specific durations of time
or at a specific times of the day. For _Duration Timers_, both the on
duration and the off duration can be defined and the timer will be
turned on and off for those durations until deactivated. For _Daily
Timers_, the start hour:minute can be set to turn a specific relay on or
off at the specific time of day.


LCDs

Data may be output to a liquid crystal display (LCD) for easy viewing.
There are only a few number fo LCDs that are supported. Only 16x2 and
20x4 character LCD displays with I2C backpacks are supported. Please see
the README for specific information regarding compatibility.

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Rese If
  t    the
  Flas LCD
  hing is
       flas
       hing
       to
       aler
       t
       you
       beca
       use
       it
       was
       inst
       ruct
       ed
       to
       do
       so
       by a
       trig
       gere
       d
       Cond
       itio
       nal
       Stat
       emen
       t,
       use
       this
       butt
       on
       to
       stop
       the
       flas
       hing
       .

  Type Sele
       ct
       eith
       er
       a
       16x2
       or
       20x4
       char
       acte
       r
       LCD
       disp
       lay.

  I2C  Sele
  Addr ct
  ess  the
       I2C
       to
       comm
       unic
       ate
       with
       the
       LCD.

  Mult If
  iple the
  xer  LCD
  I2C  is
  Addr conn
  ess  ecte
       d
       to a
       mult
       iple
       xer,
       sele
       ct
       the
       mult
       iple
       xer
       I2C
       addr
       ess.

  Mult If
  iple the
  xer  LCD
  Chan is
  nel  conn
       ecte
       d
       to a
       mult
       iple
       xer,
       sele
       ct
       the
       mult
       iple
       xer
       chan
       nel
       the
       LCD
       is
       conn
       ecte
       d
       to.

  Peri This
  od   is
       the
       peri
       od
       of
       time
       (in
       seco
       nds)
       betw
       een
       redr
       awin
       g
       the
       LCD
       with
       new
       data
       .

  Disp Sele
  lay  ct
  Line whic
  #    h
       meas
       urem
       ent
       to
       disp
       lay
       on
       each
       line
       of
       the
       LCD.
  ---------



CONTROLLER FUNCTIONS


Conditional Statements

A conditional statement is a way to perform certain actions based on
whether a condition is true. Conditional statements can be created for
both relays and sensors. Possible conditional statements include:

-   If Relay #1 turns ON, turn Relay #3 ON
-   If Relay #1 turns ON, turn Relay #4 ON for 40 seconds and notify
    critical-issue@domain.com
-   If Relay #4 turns ON for 21 seconds, turn Relay #5 ON for 50 seconds
-   If Relay #4 turns ON for 20 seconds, turn Relay #1 OFF
-   If Humidity is Greater Than 80%, turn Relay #4 ON for 40 seconds
-   If Humidity if Less Than 50%, turn Relay #1 ON for 21 seconds,
    execute ‘/usr/local/bin/myscript.sh’, and notify email@domain.com
-   If Temperature if Greater Than 35 C, deactivate PID #1

Before activating any conditional statements or PID controllers, it’s
advised to thoroughly explore all possible scenarios and plan a
configuration that eliminates conflicts. Then, trial run your
configuration before connecting devices to the relays. Some devices or
relays may respond atypically or fail when switched on and off in rapid
succession. Therefore, avoid creating an infinite loop with conditional
statements.

Conditional Statement Actions

  ---------
  Sett Desc
  ing  ript
       ion
  ---- ----
  Rela Turn
  y    a
       rela
       y
       on,
       off,
       or
       on
       for
       a
       dura
       tion
       of
       time
       .

  Comm Exec
  and  ute
       a
       comm
       and
       in
       the
       linu
       x
       shel
       l
       (as
       user
       myco
       do).

  Acti Acti
  vate vate
  PID  a
       part
       icul
       ar
       PID
       cont
       roll
       er.

  Deac Deac
  tiva tiva
  te   te
  PID  a
       part
       icul
       ar
       PID
       cont
       roll
       er.

  Emai Send
  l    an
       emai
       l
       cont
       aini
       ng
       info
       rmat
       ion
       abou
       t
       the
       curr
       ent
       cond
       itio
       n
       that
       trig
       gere
       d
       the
       cond
       itio
       nal
       to
       send
       the
       emai
       l.

  Flas Have
  h    an
  LCD  LCD
       scre
       en
       begi
       n
       flas
       hing
       in
       orde
       r
       to
       aler
       t.

  Phot Capt
  o    ure
       a
       phot
       o
       with
       the
       sele
       cted
       came
       ra.

  Emai Capt
  l    ure
  Phot a
  o    phot
       o
       and
       emai
       l
       it
       as
       an
       atta
       chme
       nt
       to
       the
       an
       emai
       l
       addr
       ess.

  Vide Capt
  o    ure
       a
       vide
       o
       of a
       set
       dura
       tion
       with
       the
       sele
       cted
       came
       ra.

  Emai Capt
  l    ure
  Vide a
  o    vide
       o
       and
       emai
       l
       it
       as
       an
       atta
       chme
       nt
       to
       the
       an
       emai
       l
       addr
       ess.
  ---------


Methods

Methods allow different types of setpoint tracking in PID controllers.
Normally, a PID controller will regulate an environmental condition to a
specific setpoint. If you would like the setpoint to change over time,
this is called setpoint tracking. Setpoint tracking is useful for
applications such as reflow ovens, thermal cyclers (DNA replication),
mimicking natural daily cycles, and more.

Universal Options

These options are shared with several method types.

  Setting           Description
  ----------------- -----------------------------------------------------
  Start Time/Date   This is the start time of a range of time.
  End Time/Date     This is the end time of a range of time.
  Start Setpoint    This is the start setpoint of a range of setpoints.
  End Setpoint      This is the end setpoint of a range of setpoints.

Specific Method Options

Time/Date Method

A time/date method allows a specific time/date span to dictate the
setpoint. This is useful for long-running methods, that may take place
over the period of days, weeks, or months.

Duration Method

A duration method allows a specific durations of time to dictate the
setpoint. This is useful for when short periods of time are required in
a method, such as those that take place over the course of a few minutes
or hours. Each duration will stack on the previous duration, meaning a
newly-added start setpoint will begin from the previous entry’s end
setpoint.

Daily (Time-Based) Method

The daily time-based method is similar to the time/date method, however
it will repeat every day. Therefore, it is essential that only the span
of one day be set in this method. Begin with the start time at 00:00:00
and end at 23:59:59 (or 00:00:00, which would be 24 hours from the
start). The start time must be equal or greater than the previous end
time.

Daily (Sine Wave) Method

The daily sine wave method defines the setpoint over the day based on a
sinusoidal wave. The sine wave is defined by y = [A * sin(B * x + C)] +
D, where A is amplitude, B is frequency, C is the angle shift, and D is
the y-axis shift. This method will repeat daily.

Daily (Bezier Curve) Method

A daily Bezier curve method define the setpoint over the day based on a
cubic Bezier curve. If unfamiliar with a Bezier curve, it is recommended
you use the graphical Bezier curve generator and use the 8 variables it
creates for 4 points (each a set of x and y). The x-axis start (x3) and
end (x0) will be automatically stretched or skewed to fit within a
24-hour period and this method will repeat daily.


PID Tuning

PID Control Theory

The PID controller is the most common regulatory controller found in
industrial settings, for it“s ability to handle both simple and complex
regulation. The PID controller has three paths, the proportional,
integral, and derivative.

The Proportional takes the error and multiplies it by the constant Kp,
to yield an output value. When the error is large, there will be a large
proportional output.

The Integral takes the error and multiplies it by Ki, then integrates it
(Ki · 1/s). As the error changes over time, the integral will
continually sum it and multiply it by the constant Ki. The integral is
used to remove perpetual error in the control system. If using Kp alone
produces an output that produces a perpetual error (i.e. if the sensor
measurement never reaches the Set Point), the integral will increase the
output until the error decreases and the Set Point is reached.

The Derivative multiplies the error by Kd, then differentiates it (Kd ·
s). When the error rate changes over time, the output signal will
change. The faster the change in error, the larger the derivative path
becomes, decreasing the output rate of change. This has the effect of
dampening overshoot and undershoot (oscillation) of the Set Point.

------------------------------------------------------------------------

Using temperature as an example, the Process Variable (PV) is the
measured temperature, the Setpoint (SP) is the desired temperature, and
the Error (e) is the distance between the measured temperature and the
desired temperature (indicating if the actual temperature is too hot or
too cold and to what degree). The error is manipulated by each of the
three PID components, producing an output, called the Manipulated
Variable (MV) or Control Variable (CV). To allow control of how much
each path contributes to the output value, each path is multiplied by a
gain (represented by _KP_, _KI_, and _KD_). By adjusting the gains, the
sensitivity of the system to each path is affected. When all three paths
are summed, the PID output is produced. If a gain is set to 0, that path
does not contribute to the output and that path is essentially turned
off.

The output can be used a number of ways, however this controller was
designed to use the output to affect the measured value (PV). This
feedback loop, with a _properly tuned_ PID controller, can achieve a set
point in a short period of time, maintain regulation with little
oscillation, and respond quickly to disturbance.

Therefor, if one would be regulating temperature, the sensor would be a
temperature sensor and the feedback device(s) would be able to heat and
cool. If the temperature is lower than the Set Point, the output value
would be positive and a heater would activate. The temperature would
rise toward the desired temperature, causing the error to decrease and a
lower output to be produced. This feedback loop would continue until the
error reaches 0 (at which point the output would be 0). If the
temperature continues to rise past the Set Point (this is may be
acceptable, depending on the degree), the PID would produce a negative
output, which could be used by the cooling device to bring the
temperature back down, to reduce the error. If the temperature would
normally lower without the aid of a cooling device, then the system can
be simplified by omitting a cooler and allowing it to lower on its own.

Implementing a controller that effectively utilizes _KP_, _KI_, and _KD_
can be challenging. Furthermore, it is often unnecessary. For instance,
the _KI_ and _KD_ can be set to 0, effectively turning them off and
producing the very popular and simple P controller. Also popular is the
PI controller. It is recommended to start with only _KP_ activated, then
experiment with _KP_ and _KI_, before finally using all three. Because
systems will vary (e.g. airspace volume, degree of insulation, and the
degree of impact from the connected device, etc.), each path will need
to be adjusted through experimentation to produce an effective output.

Quick Setup Examples

These example setups are meant to illustrate how to configure regulation
in particular directions, and not to achieve ideal values to configure
your _KP_, _KI_, and _KD_ gains. There are a number of online resources
that discuss techniques and methods that have been developed to
determine ideal PID values (such as here, here, here, here, and here)
and since there are no universal values that will work for every system,
it is recommended to conduct your own research to understand the
variables and essential to conduct your own experiments to effectively
implement them.

Provided merely as an example of the variance of PID values, one of my
setups had temperature PID values (up regulation) of _KP_ = 30, _KI_ =
1.0, and _KD_ = 0.5, and humidity PID values (up regulation) of _KP_ =
1.0, _KI_ = 0.2, and _KD_ = 0.5. Furthermore, these values may not have
been optimal but they worked well for the conditions of my environmental
chamber.

Exact Temperature Regulation

This will set up the system to raise and lower the temperature to a
certain level with two regulatory devices (one that heats and one that
cools).

Add a sensor, then save the proper device and pin/address for each
sensor and activate the sensor.

Add two relays, then save each GPIO and On Trigger state.

Add a PID, then select the newly-created sensor. Change _Setpoint_ to
the desired temperature, _Regulate Direction_ to “Both”. Set _Raise
Relay_ to the relay attached to the heating device and the _Lower Relay_
to the relay attached to the cooling device.

Set _KP_ = 1, _KI_ = 0, and _KD_ = 0, then activate the PID.

If the temperature is lower than the Set Point, the heater should
activate at some interval determined by the PID controller until the
temperature rises to the set point. If the temperature goes higher than
the Set Point (or Set Point + Buffer), the cooling device will activate
until the temperature returns to the set point. If the temperature is
not reaching the Set Point after a reasonable amount of time, increase
the _KP_ value and see how that affects the system. Experiment with
different configurations involving only _Read Interval_ and _KP_ to
achieve a good regulation. Avoid changing the _KI_ and _KD_ from 0 until
a working regulation is achieved with _KP_ alone.

View graphs in the 6 to 12 hour time span to identify how well the
temperature is regulated to the Setpoint. What is meant by
well-regulated will vary, depending on your specific application and
tolerances. Most applications of a PID controller would like to see the
proper temperature attained within a reasonable amount of time and with
little oscillation around the Setpoint.

Once regulation is achieved, experiment by reducing _KP_ slightly (~25%)
and increasing _KI_ by a low amount to start, such as 0.1 (or lower,
0.01), then start the PID and observe how well the controller regulates.
Slowly increase _KI_ until regulation becomes both quick and with little
oscillation. At this point, you should be fairly familiar with
experimenting with the system and the _KD_ value can be experimented
with once both _KP_ and _KI_ have been tuned.

High Temperature Regulation

Often the system can be simplified if two-way regulation is not needed.
For instance, if cooling is unnecessary, this can be removed from the
system and only up-regulation can be used.

Use the same configuration as the Exact Temperature Regulation example,
except change _Regulate Direction_ to “Raise” and do not touch the “Down
Relay” section.



MISCELLANEOUS


Graphs

There are two different types of graphs, Live and Asynchronous.

Live Graphs

A graphical data display that is useful for viewing data sets spanning
relatively short periods of time (hours/days/weeks). Select a time frame
to view data and continually updating data from new sensor measurements.
Multiple graphs can be created on one page that enables a dashboard to
be created of graphed sensor data. Each graphs may have one or more
sensor measurement, relay duration, or PID setpoint rendered onto it.
Several live graph options exist, such as the time period (x-axis) and
line colors, as well as navigation and data/image export options. To
edit graph options, select the plus sign on the top-right of a graph.

Asynchronous Graphs

A graphical data display that is useful for viewing data sets spanning
relatively long periods of time (weeks/months/years), which could be
very data- and processor-intensive to view as a Live Graph. Select a
time frame and data will be loaded from that time span, if it exists.
The first view will be of the entire selected data set. For every
view/zoom, 700 data points will be loaded. If there are more than 700
data points recorded for the time span selected, 700 points will be
created from an averaging of the points in that time span. This enables
much less data to be used to navigate a large data set. For instance, 4
months of data may be 10 megabytes if all of it were downloaded.
However, when viewing a 4 month span, it’s not possible to see every
data point of that 10 megabytes, and aggregating of points is
inevitable. With asynchronous loading of data, you only download what
you see. So, instead of downloading 10 megabytes every graph load, only
~50kb will be downloaded until a new zoom level is selected, at which
time only another ~50kb is downloaded.

Note: Live Graphs require measurements to be acquired, therefore at
least one sensor needs to be added and activated in order to display
live data.


Camera

Once a cameras has been set up (in the Camera Settings), it may be used
to capture still images, create time-lapses, and stream video. Cameras
may also be used with Conditional Statements to trigger a camera image
or video capture (as well as the ability to email the image/video with a
notification).


Relay Usage

Relay usage statistics are calculated for each relay, based on how long
the relay has been powered, the current draw of the device connected to
the relay, and other Relay Usage Settings.


System Backup

A backup is made to /var/Mycodo-backups when the system is upgraded
through the web interface or the upgrade script.


System Restore

If you need to restore a backup, do the following, changing the
appropriate directory names with these commands, changing ‘user’ to your
user name:

    sudo mv /home/user/Mycodo /home/user/Mycodo_old
    sudo cp -a /var/Mycodo-backups/Mycodo-TIME-COMMIT /home/user/Mycodo
    sudo /bin/bash ~/Mycodo/mycoco/scripts/upgrade_post.sh



TROUBLESHOOTING


Daemon Not Running

-   Check the Logs: From the [Gear Icon] -> Mycodo Logs page, check the
    Daemon Log for any errors. If the issue began after an upgrade, also
    check the Upgrade Log for indications of an issue.
-   Determine if the Daemon is Running: Execute
    ps aux | grep '/var/www/mycodo/env/bin/python /var/www/mycodo/mycodo/mycodo_daemon.py'
    in a terminal and look for an entry to be returned. If nothing is
    returned, the daemon is not running.
-   Daemon Lock File: If the daemon is not running, make sure the daemon
    lock file is deleted at /var/lock/mycodo.pid. The daemon cannot
    start if the lock file is present.
-   If a solution could not be found after investigating the above
    suggestions, submit a New Mycodo Issue on github.


More

Check out the Diagnosing Mycodo Issues Wiki Page on github for more
information about diagnosing issues.



SENSOR AND DEVICE SETUP


Certain sensors will require extra steps to be taken in order to set up
the interface for communication. This includes I2C, one-wire, and UART.


Sensor Interfaces

Sensors are categorized below by their communication interface.

1-Wire

The 1-wire interface should be configured with these instructions.

  DS18B20: Temperature link (Also works with: DS18S20, DS1822, DS28EA00,
  DS1825/MAX31850K)

GPIO

  DHT11, DHT22/AM2302: Relative humidity and temperature link

  SHT1x/SHT7x, SHT2x: Relative humidity and temperature link

UART

  Atlas Scientific pH: pH link

  K30: Carbon dioxide (CO2) in ppmv link

This documentation provides specific installation procedures for
configuring UART for the K30 with the Raspberry Pi version 1 or 2. Once
the K30 has been configured with this documentation, it can be tested
whether the sensor is able to be read, by executing
~/Mycodo/mycodo/tests/manual_tests/test_uart_K30.py

For Atlas Scientific sensors, this guide may be used, as well as the
above K-30 guide, to set up UART on the Raspberry Pi 1 and 2. However,
for Pi 3s, use the procedure below.

Because the UART is handled differently by the Raspberry Pi 3, from of
the addition of bluetooth, there are a different set of instructions for
getting the K30 working on the Raspberry Pi 3. If installing on a
Raspberry Pi 3, you only need to perform these steps to get the K30
working:

Run raspi-config

sudo raspi-config

Go to Advanced Options -> Serial and disable. Then edit /boot/config.txt

sudo vi /boot/config.txt

Find the line “enable_uart=0” and change it to “enable_uart=1”, then
reboot.

I2C

The I2C interface should be enabled with raspi-config.

  AM2315: Relative humidity, temperature link

  Atlas Scientific PT-1000: Temperature link

  BH1750: Light link

  BME280: Barometric pressure, humidity, temperature link

  BMP085, BMP180: Barometric pressure, temperature link

  HTU21D: Relative humidity and temperature link

  TMP006, TMP007: Contactless temperature link

  TSL2561: Light link

  Chirp: link Moisture, light, and temperature


Edge Detection

The detection of a changing signal, for instance a simple switch
completing a circuit, requires the use of edge detection. By detecting a
rising edge (LOW to HIGH), a falling edge (HIGH to LOW), or both,
actions or events can be triggered. The GPIO chosen to detect the signal
should be equipped with an appropriate resistor that either pulls the
GPIO up [to 5-volts] or down [to ground]. The option to enable the
internal pull-up or pull-down resistors is not available for safety
reasons. Use your own resistor to pull the GPIO high or low.

Examples of devices that can be used with edge detection: simple
switches and buttons, PIR motion sensors, reed switches, hall effect
sensors, float switches, and more.


Device Setup

I2C Multiplexers

All devices that connected to the Raspberry Pi by the I2C bus need to
have a unique address in order to communicate. Some sensors may have the
same address (such as the AM2315), which prevents more than one from
being connected at the same time. Others may provide the ability to
change the address, however the address range may be limited, which
limits by how many you can use at the same time. I2C multiplexers are
extremely clever and useful in these scenarios because they allow
multiple sensors with the same I2C address to be connected.

  TCA9548A: I2C Multiplexer link (I2C): Has 8 selectable addresses, so 8
  multiplexers can be connected to one Raspberry Pi. Each multiplexer
  has 8 channels, allowing up to 8 devices/sensors with the same address
  to be connected to each multiplexer. 8 multiplexers x 8 channels = 64
  devices/sensors with the same I2C address.

  TCA9545A: I2C Bus Multiplexer link (I2C): This board works a little
  differently than the TCA9548A, above. This board actually creates 4
  new I2C busses, each with their own selectable voltage, either 3.3 or
  5.0 volts. Instructions to enable the Device Tree Overlay are at
  https://github.com/camrex/i2c-mux-pca9545a. Nothing else needs to be
  done in Mycodo after that except to select the correct I2C bus when
  configuring a sensor.

Analog to Digital Converters

An analog to digital converter (ADC) allows the use of any analog sensor
that outputs a variable voltage. A voltage divider may be necessary to
attain your desired range.

  ADS1x15 link ±4.096 (I2C)

  MCP342x link ±2.048 (I2C)



DEVICE SPECIFIC INFORMATION


Temperature Sensors

Raspberry Pi

The Raspberry Pi has an integrated temperature sensor on the BCM2835 SoC
that measure the temperature of the CPU/GPU. This is the easiest sensor
to set up in Mycodo, as it is immediately available to be used.

Atlas Scientific PT-1000

The PT1000 temperature probe is a resistance type thermometer. Where PT
stands for platinum and 1000 is the measured resistance of the probe at
0°C in ohms (1k at 0°C).

Specifications

-   Accuracy ±(0.15 + (0.002*t))
-   Probe type: Class A Platinum, RTD (resistance temperature detector)
-   Cable length: 81cm (32“)
-   Cable material: Silicone rubber
-   30mm sensing area (304 SS)
-   6mm Diameter
-   BNC Connector
-   Reaction Time: 90% value in 13 seconds
-   Probe output: analog
-   Full temperature sensing range: -200°C to 850°C
-   Cable max temp 125°C
-   Cable min temp -55°C

DS18B20

The DS18B20 is a 1-Wire digital temperature sensor from Maxim IC. Each
sensor has a unique 64-Bit Serial number, allowing for a huge number of
sensors to be used on one data bus (GPIO 4).

Specifications

-   Usable temperature range: -55 to 125°C (-67°F to +257°F)
-   9 to 12 bit selectable resolution
-   Uses 1-Wire interface- requires only one digital pin for
    communication
-   Unique 64 bit ID burned into chip
-   Multiple sensors can share one pin
-   ±0.5°C Accuracy from -10°C to +85°C
-   Temperature-limit alarm system
-   Query time is less than 750ms
-   Usable with 3.0V to 5.5V power/data

TMP006, TMP007

The TMP006 Breakout can measure the temperature of an object without
making contact with it. By using a thermopile to detect and absorb the
infrared energy an object is emitting, the TMP006 Breakout can determine
how hot or cold the object is.

Specifications

-   Usable temperature range: -40°C to 125°C
-   Optimal operating voltage of 3.3V to 5V (tolerant up to 7V max)


Temperature, Humidity Sensors

AM2315

Specifications

-   0-100% humidity readings with 1% (10-90% RH) and 3% (0-10% RH and
    90-100% RH) accuracy
-   -20 to 80°C temperature readings ±0.1°C typical accuracy
-   3.5 to 5.5V power and I/O
-   10 mA max current use during conversion (while requesting data)
-   No more than 0.5 Hz sampling rate (once every 2 seconds)

DHT11

Specifications

-   3 to 5V power and I/O
-   2.5mA max current use during conversion (while requesting data)
-   20-80% humidity readings with 5% accuracy
-   0-50°C temperature readings ±2°C accuracy
-   No more than 1 Hz sampling rate (once every second)

DHT22, AM2302

Compared to the DHT11, this sensor is more precise, more accurate and
works in a bigger range of temperature/humidity, but its larger and more
expensive. The wiring is the same as the DHT11.

Specifications

-   0-100% humidity readings with 2% (10-90% RH) and 5% (0-10% RH and
    90-100% RH) accuracy
-   -40 to 80°C temperature readings ±0.5°C accuracy
-   3 to 5V power and I/O
-   2.5mA max current use during conversion (while requesting data)
-   No more than 0.5 Hz sampling rate (once every 2 seconds)

HTU21D

Specifications

-   0-100% humidity readings with 2% (20-80% RH) and 2%-5% (0-20% RH and
    80-100% RH) accuracy
-   Optimum accuracy measurements within 5 to 95% RH
-   -30 to 90°C temperature readings ±1°C typical accuracy

SHT1x

(SHT10, SHT11, SHT15)

Specifications

-   0-100% humidity readings with 2%-5% (10-90% RH) and 2%-7.5% (0-10%
    RH and 90-100% RH) accuracy
-   -40 to 125°C temperature readings ±0.5°C, ±0.4°C, and ±0.3°C typical
    accuracy (respectively)
-   2.4 to 5.5V power and I/O
-   No more than 0.125 Hz sampling rate (once every 8 seconds)

SHT7x

(SHT71, SHT75)

Specifications

-   0-100% humidity readings with 2%-3% (10-90% RH) and 2%-5% (0-10% RH
    and 90-100% RH) accuracy
-   -40 to 125°C temperature readings ±0.4°C and ±0.3°C typical
    accuracy (respectively)
-   2.4 to 5.5V power and I/O
-   No more than 0.125 Hz sampling rate (once every 8 seconds)


CO2 Sensors

K-30

[] 

Be very careful when connecting the K-30, as there is no reverse-voltage
protection. Improper connections could destroy your sensor.

Wiring instructions for the Raspberry Pi can be found here.

Specifications

-   0 – 10,000 ppm (0-5,000 ppm within specifications)
-   Repeatability: ±20 ppm ±1% of measured value within specifications
-   Accuracy: ±30 ppm ±3% of measured value within specifications
-   Non-dispersive infrared (NDIR) technology
-   Sensor life expectancy: > 15 years
-   Self-diagnostics: complete function check of the sensor module
-   Warm-up time: < 1 min. (@ full specs < 15 min)
-   0.5 Hz sampling rate (once every 2 seconds)


Moisture Sensors

Chirp

The Chirp sensor measures moisture, light, and temperature.

Specifications

-   Vin: 3 to 5V
-   I2C 7-bit address 0x77


pH Sensors

Atlas Scientific pH

The Atlas Scientific pH sensor measures the pH of a liquid.

Specifications

-   Probe Max Pressure: 690 kPa (100PSI)
-   Probe Max Depth 60 M (197 ft)
-   Probe Weight: 49 grams
-   Probe can be fully submerged in fresh or salt water indefinitely


Pressure Sensors

BME280

The BME280 is the next-generation of sensors from Bosch, and is the
upgrade to the BMP085/BMP180/BMP183 - with a low altitude noise of 0.25m
and the same fast conversion time. It has the same specifications, but
can use either I2C or SPI.

Specifications

-   300-1100 hPa (9000m to -500m above sea level)
-   -40 to +85°C operational range
-   ±3% humidity accuracy tollerance
-   ±1% humidity hysteresis
-   ±1 hPa pressure accuracy
-   ±2°C temperature accuracy
-   Vin: 3 to 5V
-   Logic: 3 to 5V compliant
-   I2C 7-bit address 0x76 or 0x77

BMP085, BMP180

The BMP180 is the next-generation of sensors from Bosch, and replaces
the BMP085. It is completely identical to the BMP085 in terms of
firmware/software/interfacing.

Specifications

-   300-1100 hPa (9000m to -500m above sea level)
-   Up to 0.03hPa / 0.25m resolution
-   -40 to +85°C operational range
-   ±2°C temperature accuracy
-   Vin: 3 to 5V
-   Logic: 3 to 5V compliant
-   I2C 7-bit address 0x77


Luminosity Sensors

BH1750

The BH1750 is an I2C luminosity sensor that provides a digital value in
lux (Lx) over a range of 1 - 65535 lx.

TSL2561

The TSL2561 SparkFun Luminosity Sensor Breakout is a sophisticated light
sensor which has a flat response across most of the visible spectrum.
Unlike simpler sensors, the TSL2561 measures both infrared and visible
light to better approximate the response of the human eye. And because
the TSL2561 is an integrating sensor (it soaks up light for a
predetermined amount of time), it is capable of measuring both small and
large amounts of light by changing the integration time.

Specifications

-   Light range: 0.1 - 40k+ Lux
-   Vin: 3V and a low supply
-   Max current: 0.6mA.


Analog to Digital Converters

ADS1x15

(ADS1015, ADS1115)

Specifications

-   Interface: I2C
-   I2C 7-bit addresses 0x48 - 0x4B
-   Input channels: 2 (differential), 4 (single-ended)
-   Power: 2.0V to 5.5V
-   Sample Rate: 1015: 128SPS to 3.3kSPS, 1115: 8SPS to 860SPS
-   Resolution: 1015: 12-bit, 1115: 16-bit

MCP342x

(MCP3422, MCP3423, MCP3424, MCP3426, MCP3427, MCP3428)

Specifications

-   Interface: I2C
-   I2C 7-bit addresses 0x68 - 0x6F
-   MCP3422: 2 channel, 12, 14, 16, or 18 bit
-   MCP3423: 2 channel, 12, 14, 16, or 18 bit
-   MCP3424: 4 channel, 12, 14, 16, or 18 bit
-   MCP3426: 2 channel, 12, 14, or 16 bit
-   MCP3427: 2 channel, 12, 14, or 16 bit
-   MCP3428: 4 channel, 12, 14, or 16 bit


Diagrams

DHT11 Diagrams

[] 

[] 

DS18B20 Diagrams

[] 

[] 

[] 

Raspberry Pi and Relay Diagrams

Raspberry Pi, 4 relays, 4 outlets, 1 DS18B20 sensor.

[Schematic: Pi, 4 relays, 4 outlets, and 1 DS18B20 sensor] 

Raspberry Pi, 8 relays, 8 outlets.

[Schematic: Pi, 8 relays, and 8 outlets]
